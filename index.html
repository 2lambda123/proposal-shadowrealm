<!doctype html>
<html lang="en-GB-oxendict"><head>
<meta charset="utf-8">
<link href="ecmarkup.css" rel="stylesheet">
<script src="ecmarkup.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/solarized-light.min.css">
<title>Realms API</title></head>

<body><div id="menu-toggle">☰</div><div id="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-well-known-intrinsic-objects" title="Well-known intrinsic objects"><span class="secnum">1</span> Well-known intrinsic objects</a></li><li><span class="item-toggle">◢</span><a href="#sec-wrapped-function-exotic-objects" title="Wrapped Function Exotic Objects"><span class="secnum">2</span> Wrapped Function Exotic Objects</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-wrapped-function-exotic-objects-call-thisargument-argumentslist" title="[[Call]] ( thisArgument, argumentsList )"><span class="secnum">2.1</span> [[Call]] ( <var>thisArgument</var>, <var>argumentsList</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-wrappedfunctioncreate" title="WrappedFunctionCreate ( callerRealm, targetFunction )"><span class="secnum">2.2</span> WrappedFunctionCreate ( <var>callerRealm</var>, <var>targetFunction</var> )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-realm-objects" title="Realm Objects"><span class="secnum">3</span> Realm Objects</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-realm-abstracts" title="Realm Abstract Operations"><span class="secnum">3.1</span> Realm Abstract Operations</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-performrealmeval" title="PerformRealmEval ( sourceText, callerRealm, evalRealm )"><span class="secnum">3.1.1</span> PerformRealmEval ( <var>sourceText</var>, <var>callerRealm</var>, <var>evalRealm</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-performrealmimportvalue" title="PerformRealmImportValue ( specifierString, exportNameString, callerRealm, evalRealm, evalContext )"><span class="secnum">3.1.2</span> PerformRealmImportValue ( <var>specifierString</var>, <var>exportNameString</var>, <var>callerRealm</var>, <var>evalRealm</var>, <var>evalContext</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-getwrappedvalue" title="GetWrappedValue ( callerRealm, value )"><span class="secnum">3.1.3</span> GetWrappedValue ( <var>callerRealm</var>, <var>value</var> )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-realm-constructor" title="The Realm Constructor"><span class="secnum">3.2</span> The Realm Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-realm" title="Realm ()"><span class="secnum">3.2.1</span> Realm ()</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-properties-of-the-realm-constructor" title="Properties of the Realm Constructor"><span class="secnum">3.3</span> Properties of the Realm Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-realm.prototype" title="Realm.prototype"><span class="secnum">3.3.1</span> Realm.prototype</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-properties-of-the-realm-prototype-object" title="Properties of the Realm Prototype Object"><span class="secnum">3.4</span> Properties of the Realm Prototype Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-realm.prototype.eval" title="Realm.prototype.evaluate ( sourceText )"><span class="secnum">3.4.1</span> Realm.prototype.evaluate ( <var>sourceText</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-realm.prototype.importValue" title="Realm.prototype.importValue ( specifier, exportName )"><span class="secnum">3.4.2</span> Realm.prototype.importValue ( <var>specifier</var>, <var>exportName</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-validaterealmobject" title="ValidateRealmObject( argument )"><span class="secnum">3.4.3</span> ValidateRealmObject( <var>argument</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-realm.prototype-@@tostringtag" title="Realm.prototype [ @@toStringTag ]"><span class="secnum">3.4.4</span> Realm.prototype [ @@toStringTag ]</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-properties-of-realm-instances" title="Properties of Realm Instances"><span class="secnum">3.5</span> Properties of Realm Instances</a></li><li><span class="item-toggle">◢</span><a href="#sec-realm-host-operations" title="Host operations"><span class="secnum">3.6</span> Host operations</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-host-initialize-synthetic-realm" title="Runtime Semantics: HostInitializeSyntheticRealm ( realm )"><span class="secnum">3.6.1</span> RS: HostInitializeSyntheticRealm ( <var>realm</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-hostimportmodulebindingdynamically" title="HostImportModuleBindingDynamically (callerRealm, evalRealm, specifier, exportName, promiseCapability )"><span class="secnum">3.6.2</span> HostImportModuleBindingDynamically (<var>callerRealm</var>, <var>evalRealm</var>, <var>specifier</var>, <var>exportName</var>, <var>promiseCapability</var> )</a></li></ol></li></ol></li></ol></div></div><div id="spec-container"><h1 class="version">Stage 2 Draft / May 5, 2021</h1><h1 class="title">Realms API</h1>


<emu-clause id="sec-well-known-intrinsic-objects">
	<h1><span class="secnum">1</span> Well-known intrinsic objects</h1>
	<emu-table id="table-7" caption="Well-known Intrinsic Objects"><figure><figcaption>Table 1: Well-known Intrinsic Objects</figcaption>
		<table>
			<tbody>
				<tr>
					<th>Intrinsic Name</th>
					<th>Global Name</th>
					<th>ECMAScript Language Association</th>
				</tr>
				<tr>
					<td><emu-xref href="#sec-realm-constructor" id="_ref_5"><a href="#sec-realm-constructor">%Realm%</a></emu-xref></td>
					<td><code>Realm</code></td>
					<td>The <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> (<emu-xref href="#sec-realm-constructor" id="_ref_0"><a href="#sec-realm-constructor">3.2</a></emu-xref>)</td>
				</tr>
			</tbody>
		</table>
	</figure></emu-table>
</emu-clause>

<emu-clause id="sec-wrapped-function-exotic-objects">
	<h1><span class="secnum">2</span> Wrapped Function Exotic Objects</h1>
	<p>A <emu-xref href="#wrapped-function-exotic-object" id="_ref_6"><a href="#wrapped-function-exotic-object">wrapped function exotic object</a></emu-xref> is an <emu-xref href="#exotic-object"><a href="https://tc39.es/ecma262/#exotic-object">exotic object</a></emu-xref> that wraps a callable object. A <emu-xref href="#wrapped-function-exotic-object" id="_ref_7"><a href="#wrapped-function-exotic-object">wrapped function exotic object</a></emu-xref> is callable (it has a [[Call]] internal method). Calling a <emu-xref href="#wrapped-function-exotic-object" id="_ref_8"><a href="#wrapped-function-exotic-object">wrapped function exotic object</a></emu-xref> generally results in a call of its wrapped function.</p>

	<p>An object is a <dfn id="wrapped-function-exotic-object">wrapped function exotic object</dfn> if its [[Call]] internal method use the following implementations, and its other essential internal methods use the definitions found in <emu-xref href="#sec-ordinary-object-internal-methods-and-internal-slots"><a href="https://tc39.es/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots">9.1</a></emu-xref>. These methods are installed in <emu-xref aoid="WrappedFunctionCreate" id="_ref_9"><a href="#sec-wrappedfunctioncreate">WrappedFunctionCreate</a></emu-xref>.</p>

	<p>Wrapped function exotic objects do not have the internal slots of ECMAScript function objects listed in <emu-xref href="#table-internal-slots-of-ecmascript-function-objects"></emu-xref>. Instead they have the internal slots listed in <emu-xref href="#table-internal-slots-of-wrapped-function-exotic-objects" id="_ref_1"><a href="#table-internal-slots-of-wrapped-function-exotic-objects">Table 2</a></emu-xref>, in addition to [[Prototype]] and [[Extensible]].</p>
	<emu-table id="table-internal-slots-of-wrapped-function-exotic-objects" caption="Internal Slots of Wrapped Function Exotic Objects"><figure><figcaption>Table 2: Internal Slots of Wrapped Function Exotic Objects</figcaption>
	<table>
		<tbody>
		<tr>
		<th>
			Internal Slot
		</th>
		<th>
			Type
		</th>
		<th>
			Description
		</th>
		</tr>
		<tr>
		<td>
			[[WrappedTargetFunction]]
		</td>
		<td>
			Callable Object
		</td>
		<td>
			The wrapped <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>.
		</td>
		</tr>
		<tr>
		<td>
			[[Realm]]
		</td>
		<td>
			<emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>
		</td>
		<td>
			The <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">realm</a></emu-xref> in which the wrapped <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref> was created.
		</td>
		</tr>
		</tbody>
	</table>
	</figure></emu-table>

	<emu-clause id="sec-wrapped-function-exotic-objects-call-thisargument-argumentslist">
		<h1><span class="secnum">2.1</span> [[Call]] ( <var>thisArgument</var>, <var>argumentsList</var> )</h1>
		<p>The [[Call]] internal method of a <emu-xref href="#wrapped-function-exotic-object" id="_ref_10"><a href="#wrapped-function-exotic-object">wrapped function exotic object</a></emu-xref> <var>F</var> takes arguments <var>thisArgument</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and <var>argumentsList</var> (a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of ECMAScript language values). It performs the following steps when called:</p>
		<emu-alg><ol><li>Let <var>target</var> be <var>F</var>.[[WrappedTargetFunction]].</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="IsCallable" id="_ref_11"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>target</var>) is <emu-val>true</emu-val>.</li><li>Let <var>targetRealm</var> be ?&nbsp;<emu-xref aoid="GetFunctionRealm" id="_ref_12"><a href="https://tc39.es/ecma262/#sec-getfunctionrealm">GetFunctionRealm</a></emu-xref>(<var>target</var>).</li><li>Let <var>callerRealm</var> be ?&nbsp;<emu-xref aoid="GetFunctionRealm" id="_ref_13"><a href="https://tc39.es/ecma262/#sec-getfunctionrealm">GetFunctionRealm</a></emu-xref>(<var>F</var>).</li><li>For each element <var>key</var> of <var>argumentsList</var>, do<ol><li>Let o be <var>argumentsList</var>[<var>key</var>].</li><li>Set <var>argumentsList</var>[<var>key</var>] to ?&nbsp;<emu-xref aoid="GetWrappedValue" id="_ref_14"><a href="#sec-getwrappedvalue">GetWrappedValue</a></emu-xref>(<var>targetRealm</var>, <var>o</var>).</li></ol></li><li>Let <var>wrappedThisArgument</var> to ?&nbsp;<emu-xref aoid="GetWrappedValue" id="_ref_15"><a href="#sec-getwrappedvalue">GetWrappedValue</a></emu-xref>(<var>targetRealm</var>, <var>thisArgument</var>).</li><li>Let <var>result</var> be the <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion Record</a></emu-xref> of <emu-xref aoid="Call" id="_ref_16"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>target</var>, <var>wrappedThisArgument</var>, <var>argumentsList</var>).</li><li>If <var>result</var>.[[Type]] is <emu-const>normal</emu-const> or <var>result</var>.[[Type]] is <emu-const>return</emu-const>, then<ol><li>Set <var>value</var> to <emu-xref aoid="NormalCompletion" id="_ref_17"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<var>result</var>.[[Value]]).</li><li>Return ?&nbsp;<emu-xref aoid="GetWrappedValue" id="_ref_18"><a href="#sec-getwrappedvalue">GetWrappedValue</a></emu-xref>(<var>callerRealm</var>, <var>value</var>).</li></ol></li><li>Else,<ol><li>Throw a newly created TypeError object associate to the <var>callerRealm</var>.</li></ol></li></ol></emu-alg>
		<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
			In the case of an abrupt <emu-const>throw</emu-const> completion, the type of error to be created should match the type of the abrupt throw completion record. This could be revisited when merging into the main specification. Additionally, in the case of a <emu-const>break</emu-const> or <emu-const>continue</emu-const> completion, since those are not supported, a TypeError is expected.
		</div></emu-note>
	</emu-clause>

	<emu-clause id="sec-wrappedfunctioncreate" aoid="WrappedFunctionCreate">
		<h1><span class="secnum">2.2</span> WrappedFunctionCreate ( <var>callerRealm</var>, <var>targetFunction</var> )</h1>
		<p>The abstract operation WrappedFunctionCreate takes arguments <var>callerRealm</var> and <var>targetFunction</var>. It is used to specify the creation of new wrapped function exotic objects. It performs the following steps when called:</p>
		<emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>callerRealm</var> is a <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="IsCallable" id="_ref_19"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>targetFunction</var>) is <emu-val>true</emu-val>.</li><li>Let <var>internalSlotsList</var> be the internal slots listed in <emu-xref href="#table-internal-slots-of-wrapped-function-exotic-objects" id="_ref_2"><a href="#table-internal-slots-of-wrapped-function-exotic-objects">Table 2</a></emu-xref>, plus [[Prototype]] and [[Extensible]].</li><li>Let <var>obj</var> be !&nbsp;MakeBasicObject(<var>internalSlotsList</var>).</li><li>Set <var>obj</var>.[[Prototype]] to <var>callerRealm</var>.[[Intrinsics]].[[<emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>]].</li><li>Set <var>obj</var>.[[Call]] as described in <emu-xref href="#sec-wrapped-function-exotic-objects-call-thisargument-argumentslist" id="_ref_3"><a href="#sec-wrapped-function-exotic-objects-call-thisargument-argumentslist">2.1</a></emu-xref>.</li><li>Set <var>obj</var>.[[Realm]] to <var>callerRealm</var>.</li><li>Set <var>obj</var>.[[WrappedTargetFunction]] to <var>targetFunction</var>.</li><li>Return <var>obj</var>.</li></ol></emu-alg>
	</emu-clause>
</emu-clause>

<emu-clause id="sec-realm-objects">
	<h1><span class="secnum">3</span> Realm Objects</h1>
	<emu-clause id="sec-realm-abstracts">
		<h1><span class="secnum">3.1</span> Realm Abstract Operations</h1>

		<emu-clause id="sec-performrealmeval" aoid="PerformRealmEval">
			<h1><span class="secnum">3.1.1</span> PerformRealmEval ( <var>sourceText</var>, <var>callerRealm</var>, <var>evalRealm</var> )</h1>
			<emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type" id="_ref_20"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>sourceText</var>) is String.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>callerRealm</var> is a <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>evalRealm</var> is a <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li>Perform ?&nbsp;<emu-xref aoid="HostEnsureCanCompileStrings" id="_ref_21"><a href="https://tc39.es/ecma262/#sec-hostensurecancompilestrings">HostEnsureCanCompileStrings</a></emu-xref>(<var>callerRealm</var>, <var>evalRealm</var>).</li><li>Let <var>inFunction</var> be <emu-val>false</emu-val>.</li><li>Let <var>inMethod</var> be <emu-val>false</emu-val>.</li><li>Let <var>inDerivedConstructor</var> be <emu-val>false</emu-val>.</li><li>Perform the following substeps in an implementation-defined order, possibly interleaving parsing and error detection:<ol><li>Let <var>script</var> be ParseText(! StringToCodePoints(<var>sourceText</var>), <emu-nt><a href="https://tc39.es/ecma262/#prod-Script">Script</a></emu-nt>).</li><li>If <var>script</var> is a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of errors, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>script</var> Contains <emu-nt><a href="https://tc39.es/ecma262/#prod-ScriptBody">ScriptBody</a></emu-nt> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>body</var> be the <emu-nt><a href="https://tc39.es/ecma262/#prod-ScriptBody">ScriptBody</a></emu-nt> of <var>script</var>.</li><li>If <var>inFunction</var> is <emu-val>false</emu-val>, and <var>body</var> Contains <emu-nt><a href="https://tc39.es/ecma262/#prod-NewTarget">NewTarget</a></emu-nt>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>inMethod</var> is <emu-val>false</emu-val>, and <var>body</var> Contains <emu-nt><a href="https://tc39.es/ecma262/#prod-SuperProperty">SuperProperty</a></emu-nt>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>inDerivedConstructor</var> is <emu-val>false</emu-val>, and <var>body</var> Contains <emu-nt><a href="https://tc39.es/ecma262/#prod-SuperCall">SuperCall</a></emu-nt>, throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>Let <var>strictEval</var> be IsStrict of <var>script</var>.</li><li>Let <var>runningContext</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>lexEnv</var> be <emu-xref aoid="NewDeclarativeEnvironment" id="_ref_22"><a href="https://tc39.es/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>evalRealm</var>.[[GlobalEnv]]).</li><li>Let <var>varEnv</var> be <var>evalRealm</var>.[[GlobalEnv]].</li><li>If <var>strictEval</var> is <emu-val>true</emu-val>, set <var>varEnv</var> to <var>lexEnv</var>.</li><li>If <var>runningContext</var> is not already suspended, suspend <var>runningContext</var>.</li><li>Let <var>evalContext</var> be a new ECMAScript code <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref>.</li><li>Set <var>evalContext</var>'s Function to <emu-val>null</emu-val>.</li><li>Set <var>evalContext</var>'s <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> to <var>evalRealm</var>.</li><li>Set <var>evalContext</var>'s ScriptOrModule to <emu-val>null</emu-val>.</li><li>Set <var>evalContext</var>'s VariableEnvironment to <var>varEnv</var>.</li><li>Set <var>evalContext</var>'s LexicalEnvironment to <var>lexEnv</var>.</li><li>Push <var>evalContext</var> onto the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>; <var>evalContext</var> is now the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>result</var> be <emu-xref aoid="EvalDeclarationInstantiation" id="_ref_23"><a href="https://tc39.es/ecma262/#sec-evaldeclarationinstantiation">EvalDeclarationInstantiation</a></emu-xref>(<var>body</var>, <var>varEnv</var>, <var>lexEnv</var>, <var>strictEval</var>).</li><li>If <var>result</var>.[[Type]] is <emu-const>normal</emu-const>, then<ol><li>Set <var>result</var> to the result of evaluating <var>body</var>.</li></ol></li><li><emu-xref aoid="Suspend" id="_ref_24"><a href="https://tc39.es/ecma262/#sec-suspend">Suspend</a></emu-xref> <var>evalContext</var> and remove it from the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>.</li><li>Resume the context that is now on the top of the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref> as the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>If <var>result</var>.[[Type]] is not <emu-const>normal</emu-const>, throw a newly created TypeError object associate to the <var>callerRealm</var>.</li><li>Return ?&nbsp;<emu-xref aoid="GetWrappedValue" id="_ref_25"><a href="#sec-getwrappedvalue">GetWrappedValue</a></emu-xref>(<var>callerRealm</var>, <var>result</var>.[[Value]]).</li></ol></emu-alg>
			<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
				In the case of an abrupt <emu-const>throw</emu-const> completion, the type of error to be created should match the type of the abrupt throw completion record. This could be revisited when merging into the main specification. Additionally, in the case of a <emu-const>break</emu-const> or <emu-const>continue</emu-const> completion, since those are not supported, a TypeError is expected. There should be no <emu-const>return</emu-const> completion because this is a top level script evaluation, in which case a return <emu-nt><a href="https://tc39.es/ecma262/#prod-Statement">Statement</a></emu-nt> must result in a parsing error.
			</div></emu-note>
		</emu-clause>

		<emu-clause id="sec-performrealmimportvalue" aoid="PerformRealmImportValue">
			<h1><span class="secnum">3.1.2</span> PerformRealmImportValue ( <var>specifierString</var>, <var>exportNameString</var>, <var>callerRealm</var>, <var>evalRealm</var>, <var>evalContext</var> )</h1>
			<emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type" id="_ref_26"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>specifierString</var>) is String.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type" id="_ref_27"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>exportNameString</var>) is String.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>callerRealm</var> is a <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>evalRealm</var> is a <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability" id="_ref_28"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Let <var>runningContext</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>If <var>runningContext</var> is not already suspended, suspend <var>runningContext</var>.</li><li>Push <var>evalContext</var> onto the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>; <var>evalContext</var> is now the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Perform !&nbsp;<emu-xref aoid="HostImportModuleBindingDynamically" id="_ref_29"><a href="#sec-hostimportmodulebindingdynamically">HostImportModuleBindingDynamically</a></emu-xref>(<var>callerRealm</var>, <var>evalRealm</var>, <var>specifierString</var>, <var>exportNameString</var>, <var>promiseCapability</var>).</li><li><emu-xref aoid="Suspend" id="_ref_30"><a href="https://tc39.es/ecma262/#sec-suspend">Suspend</a></emu-xref> <var>evalContext</var> and remove it from the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>.</li><li>Resume the context that is now on the top of the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref> as the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></emu-alg>

			<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
				The <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref>'s Execution Context is passed as a parameter <var>evalContext</var>. An alternative phrasing would be to create an extra <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref> around the call to <emu-xref aoid="HostImportModuleBindingDynamically" id="_ref_31"><a href="#sec-hostimportmodulebindingdynamically">HostImportModuleBindingDynamically</a></emu-xref> in order to execute within the appropriate <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref>--the host can reference the current <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> to figure out how the import should work, similar to <emu-xref aoid="PerformRealmEval" id="_ref_32"><a href="#sec-performrealmeval">PerformRealmEval</a></emu-xref>, which could be revisited when merging into the main specification.
			</div></emu-note>
		</emu-clause>

		<emu-clause id="sec-getwrappedvalue" aoid="GetWrappedValue">
			<h1><span class="secnum">3.1.3</span> GetWrappedValue ( <var>callerRealm</var>, <var>value</var> )</h1>
			<emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>callerRealm</var> is a <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li>If <emu-xref aoid="Type" id="_ref_33"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>value</var>) is Object, then<ol><li>If <emu-xref aoid="IsCallable" id="_ref_34"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>value</var>) is <emu-val>false</emu-val>, throw a TypeError exception.</li><li>Return ?&nbsp;<emu-xref aoid="WrappedFunctionCreate" id="_ref_35"><a href="#sec-wrappedfunctioncreate">WrappedFunctionCreate</a></emu-xref>(<var>callerRealm</var>, <var>value</var>).</li></ol></li><li>Return <var>value</var>.</li></ol></emu-alg>
		</emu-clause>
	</emu-clause>

	<emu-clause id="sec-realm-constructor">
		<h1><span class="secnum">3.2</span> The Realm Constructor</h1>
		<p>The <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
		<ul>
			<li>is the intrinsic object <dfn>%Realm%</dfn>.</li>
			<li>is the initial value of the <emu-val>"Realm"</emu-val> property of the <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref>.</li>
			<li>is not intended to be called as a function and will throw an exception when called in that manner.</li>
			<li>creates and initializes a new <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> object when called as a <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>.</li>
			<li>is designed to be subclassable. It may be used as the value in an <code>extends</code> clause of a class definition. Subclass constructors that intend to inherit the specified <code>Realm</code> behaviour must include a <code>super</code> call to the <code>Realm</code> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> to create and initialize the subclass instance with the internal state necessary to support the <code>Realm.prototype</code> built-in methods.</li>
		</ul>

		<emu-clause id="sec-realm">
			<h1><span class="secnum">3.2.1</span> Realm ()</h1>
			<p>When the <code>Realm</code> function is called with no arguments, the following steps are taken:</p>
			<emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>O</var> be ?&nbsp;<emu-xref aoid="OrdinaryCreateFromConstructor" id="_ref_36"><a href="https://tc39.es/ecma262/#sec-ordinarycreatefromconstructor">OrdinaryCreateFromConstructor</a></emu-xref>(NewTarget, "%Realm.prototype%", « [[Realm]], [[ExecutionContext]] »).</li><li>Let <var>realmRec</var> be <emu-xref aoid="CreateRealm" id="_ref_37"><a href="https://tc39.es/ecma262/#sec-createrealm">CreateRealm</a></emu-xref>().</li><li>Set <var>O</var>.[[Realm]] to <var>realmRec</var>.</li><li>Let <var>context</var> be a new <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref>.</li><li>Set the Function of <var>context</var> to <emu-val>null</emu-val>.</li><li>Set the <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> of <var>context</var> to <var>realmRec</var>.</li><li>Set the ScriptOrModule of <var>context</var> to <emu-val>null</emu-val>.</li><li>Set <var>O</var>.[[ExecutionContext]] to <var>context</var>.</li><li>Perform ?&nbsp;<emu-xref aoid="SetRealmGlobalObject" id="_ref_38"><a href="https://tc39.es/ecma262/#sec-setrealmglobalobject">SetRealmGlobalObject</a></emu-xref>(<var>realmRec</var>, <emu-val>undefined</emu-val>, <emu-val>undefined</emu-val>).</li><li>Perform ?&nbsp;<emu-xref aoid="SetDefaultGlobalBindings" id="_ref_39"><a href="https://tc39.es/ecma262/#sec-setdefaultglobalbindings">SetDefaultGlobalBindings</a></emu-xref>(<var>O</var>.[[Realm]]).</li><li>Perform ?&nbsp;<emu-xref aoid="HostInitializeSyntheticRealm" id="_ref_40"><a href="#sec-host-initialize-synthetic-realm">HostInitializeSyntheticRealm</a></emu-xref>(<var>O</var>.[[Realm]]).</li><li>Return <var>O</var>.</li></ol></emu-alg>
		</emu-clause>
	</emu-clause>

	<emu-clause id="sec-properties-of-the-realm-constructor">
		<h1><span class="secnum">3.3</span> Properties of the Realm Constructor</h1>
		<p>The <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
		<ul>
			<li>has a [[Prototype]] internal slot whose value is <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li>
			<li>has the following properties:</li>
		</ul>

		<emu-clause id="sec-realm.prototype">
			<h1><span class="secnum">3.3.1</span> Realm.prototype</h1>
			<p>The initial value of <emu-val>Realm.prototype</emu-val> is %Realm.prototype%.</p>
			<p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val> }.</p>
		</emu-clause>
	</emu-clause>

	<emu-clause id="sec-properties-of-the-realm-prototype-object">
		<h1><span class="secnum">3.4</span> Properties of the Realm Prototype Object</h1>
		<p>The <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototype object:</p>
		<ul>
			<li>has a [[Prototype]] internal slot whose value is <dfn>%Object.prototype%</dfn>.</li>
			<li>is %Realm.prototype%.</li>
			<li>is an ordinary object.</li>
			<li>does not have a [[Realm]] or any other of the internal slots that are specific to <var>Realm</var> instance objects.</li>
		</ul>

		<emu-clause id="sec-realm.prototype.eval">
			<h1><span class="secnum">3.4.1</span> Realm.prototype.evaluate ( <var>sourceText</var> )</h1>

			<p>Synchronously execute a top-level script. The <var>sourceText</var> is interpreted as a Script and evaluated with this bound to the <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">realm</a></emu-xref>'s <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref>.</p>

			<emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;ValidateRealmObject(<var>O</var>).</li><li>If <emu-xref aoid="Type" id="_ref_41"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>sourceText</var>) is not String, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>callerRealm</var> be <emu-xref href="#current-realm"><a href="https://tc39.es/ecma262/#current-realm">the current Realm Record</a></emu-xref>.</li><li>Let <var>evalRealm</var> be <var>O</var>.[[Realm]].</li><li>Return ?&nbsp;<emu-xref aoid="PerformRealmEval" id="_ref_42"><a href="#sec-performrealmeval">PerformRealmEval</a></emu-xref>(<var>sourceText</var>, <var>callerRealm</var>, <var>evalRealm</var>).</li></ol></emu-alg>

			<emu-note><span class="note">Note</span><div class="note-contents">
				Extensible web: This is the dynamic equivalent of a &lt;script&gt; in HTML.
			</div></emu-note>
		</emu-clause>

		<emu-clause id="sec-realm.prototype.importValue">
			<h1><span class="secnum">3.4.2</span> Realm.prototype.importValue ( <var>specifier</var>, <var>exportName</var> )</h1>
			<p>The following steps are performed:</p>
			<emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;ValidateRealmObject(<var>O</var>).</li><li>Let <var>specifierString</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_43"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>specifier</var>).</li><li>Let <var>exportNameString</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_44"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>exportName</var>).</li><li>Let <var>callerRealm</var> be <emu-xref href="#current-realm"><a href="https://tc39.es/ecma262/#current-realm">the current Realm Record</a></emu-xref>.</li><li>Let <var>evalRealm</var> be <var>O</var>.[[Realm]].</li><li>Let <var>evalContext</var> be <var>O</var>.[[ExecutionContext]].</li><li>Return ?&nbsp;<emu-xref aoid="PerformRealmImportValue" id="_ref_45"><a href="#sec-performrealmimportvalue">PerformRealmImportValue</a></emu-xref>(<var>specifierString</var>, <var>exportNameString</var>, <var>callerRealm</var>, <var>evalRealm</var>, <var>evalContext</var>).</li></ol></emu-alg>

			<emu-note><span class="note">Note</span><div class="note-contents">
				Extensible web: This is equivalent to dynamic import without having to evaluate a script source, which might not be available (e.g.: when CSP is blocking source evaluation).
			</div></emu-note>
		</emu-clause>

		<emu-clause id="sec-validaterealmobject">
			<h1><span class="secnum">3.4.3</span> ValidateRealmObject( <var>argument</var> )</h1>
			<p>The abstract operation ValidateRealmObject takes argument <var>argument</var>. It performs the following steps when called:</p>

			<emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot" id="_ref_46"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[Realm]]).</li><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot" id="_ref_47"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[ExecutionContext]]).</li></ol></emu-alg>
		</emu-clause>

		<emu-clause id="sec-realm.prototype-@@tostringtag">
			<h1><span class="secnum">3.4.4</span> Realm.prototype [ @@toStringTag ]</h1>
			<p>The initial value of the @@toStringTag property is the String value "<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref>".</p>
			<p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>true</emu-val> }.</p>
		</emu-clause>
	</emu-clause>

	<emu-clause id="sec-properties-of-realm-instances">
		<h1><span class="secnum">3.5</span> Properties of Realm Instances</h1>
		<p><emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> instances are ordinary objects that inherit properties from the <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototype object (the intrinsic, %Realm.prototype%). <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> instances are initially created with the internal slots described in <emu-xref href="#table-internal-slots-of-realm-instances" id="_ref_4"><a href="#table-internal-slots-of-realm-instances">Table 3</a></emu-xref>.</p>

		<emu-table id="table-internal-slots-of-realm-instances" caption="Internal Slots of Realm Instances"><figure><figcaption>Table 3: Internal Slots of <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> Instances</figcaption>
			<table>
				<tbody>
					<tr>
						<th>Internal Slot</th>
						<th>Type</th>
						<th>Description</th>
					</tr>
					<tr>
						<td>[[Realm]]</td>
						<td><emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref></td>
						<td>The <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref> for the initial <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref>.</td>
					</tr>
					<tr>
						<td>[[ExecutionContext]]</td>
						<td><emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">Execution context</a></emu-xref></td>
						<td>An <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref> wherein the current <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> is this [[Realm]].</td>
					</tr>
				</tbody>
			</table>
		</figure></emu-table>
	</emu-clause>

	<emu-clause id="sec-realm-host-operations">
		<h1><span class="secnum">3.6</span> Host operations</h1>
		<emu-clause id="sec-host-initialize-synthetic-realm" aoid="HostInitializeSyntheticRealm">
			<h1><span class="secnum">3.6.1</span> Runtime Semantics: HostInitializeSyntheticRealm ( <var>realm</var> )</h1>
			<p>
				HostInitializeSyntheticRealm is an implementation-defined abstract
				operation used to inform the host of any newly created realms from
				the <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>. Its return value is not used, though it may
				throw an exception. The idea of this hook is to initialize host
				data structures related to the <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref>, e.g., for module loading. It
				is not expected that this hook would add properties to the <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref>'s
				<emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref>.
			</p>
		</emu-clause>

		<emu-clause id="sec-hostimportmodulebindingdynamically" aoid="HostImportModuleBindingDynamically">
			<h1><span class="secnum">3.6.2</span> HostImportModuleBindingDynamically (<var>callerRealm</var>, <var>evalRealm</var>, <var>specifier</var>, <var>exportName</var>, <var>promiseCapability</var> )</h1>
			<p>The host-defined abstract operation HostImportModuleBindingDynamically takes arguments <var>callerRealm</var> (a <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>), <var>evalRealm</var> (a <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>), <var>specifier</var> (a <emu-nt><a href="https://tc39.es/ecma262/#prod-ModuleSpecifier">ModuleSpecifier</a></emu-nt> String), <var>exportName</var> (a <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt> String) and <var>promiseCapability</var> (a PromiseCapability <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref>). It performs any necessary setup work in order to make available the module corresponding to <var>specifier</var> occurring within the context of the script or module represented by <var>referencingScriptOrModule</var>. <var>referencingScriptOrModule</var> is <emu-val>null</emu-val>. It then performs <emu-xref aoid="FinishDynamicImport" id="_ref_48"><a href="https://tc39.es/ecma262/#sec-finishdynamicimport">FinishDynamicImport</a></emu-xref> to finish the dynamic import process.</p>
			<p>The implementation of HostImportModuleBindingDynamically must conform with the implementation of <emu-xref aoid="HostImportModuleDynamically" id="_ref_49"><a href="https://tc39.es/ecma262/#sec-hostimportmoduledynamically">HostImportModuleDynamically</a></emu-xref> first and foremost, second, it should conform with the following:</p>
			<li>
				The host environment must conform to one of the two following sets of requirements:
				<dl>
				<dt>Success path</dt>

				<dd>
					<ul>
						<li>The completion value must be the wrapped value exported value for the <var>exportName</var> associated to the Module Namespace Object for the <var>callerRealm</var>.</li>
					</ul>
				</dd>

				<dt>Failure path</dt>

				<dd>
					<ul>
						<li>At some future time, the Module Namespace Object does not contain the <var>exportName</var> as part of the ExportNames, with the <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref> representing the cause of failure for the <var>callerRealm</var>.</li>
					</ul>
				</dd>
				</dl>
			</li>
		</emu-clause>
	</emu-clause>

</emu-clause>


</div></body></html>