<!doctype html>
<html lang="en-GB-oxendict"><head>
<meta charset="utf-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/base16/solarized-light.min.css"><link href="ecmarkup.css" rel="stylesheet">
<script src="ecmarkup.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/solarized-light.min.css">
<title>ShadowRealm API</title></head>

<body><div id="shortcuts-help">
<ul>
  <li><span>Toggle shortcuts help</span><code>?</code></li>
  <li><span>Toggle "can call user code" annotations</span><code>u</code></li>

  <li><span>Jump to search box</span><code>/</code></li>
</ul></div><div id="menu-toggle"><svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%; stroke:currentColor" viewBox="0 0 120 120">
      <title>Menu</title>
      <path stroke-width="10" stroke-linecap="round" d="M30,60 h60  M30,30 m0,5 h60  M30,90 m0,-5 h60"></path>
    </svg></div><div id="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-well-known-intrinsic-objects" title="Well-known intrinsic objects"><span class="secnum">1</span> Well-known intrinsic objects</a></li><li><span class="item-toggle">◢</span><a href="#sec-wrapped-function-exotic-objects" title="Wrapped Function Exotic Objects"><span class="secnum">2</span> Wrapped Function Exotic Objects</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-wrapped-function-exotic-objects-call-thisargument-argumentslist" title="[[Call]] ( thisArgument, argumentsList )"><span class="secnum">2.1</span> [[Call]] ( <var>thisArgument</var>, <var>argumentsList</var> )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-shadowrealm-objects" title="ShadowRealm Objects"><span class="secnum">3</span> ShadowRealm Objects</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-shadowrealm-abstracts" title="ShadowRealm Abstract Operations"><span class="secnum">3.1</span> ShadowRealm Abstract Operations</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-wrappedfunctioncreate" title="
				WrappedFunctionCreate (
					callerRealm: a Realm Record,
					Target: a function object,
				)
			"><span class="secnum">3.1.1</span> 
				WrappedFunctionCreate (
					<var>callerRealm</var>: a Realm Record,
					<var>Target</var>: a function object,
				)
			</a></li><li><span class="item-toggle">◢</span><a href="#sec-copynameandlength" title="
				CopyNameAndLength (
					F: a function object,
					Target: a function object,
					optional prefix: a String,
					optional argCount: a Number,
				)
			"><span class="secnum">3.1.2</span> 
				CopyNameAndLength (
					<var>F</var>: a function object,
					<var>Target</var>: a function object,
					optional <var>prefix</var>: a String,
					optional <var>argCount</var>: a Number,
				)
			</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-function.prototype.bind" title="Function.prototype.bind ( thisArg, ...args )"><span class="secnum">3.1.2.1</span> Function.prototype.bind ( <var>thisArg</var>, ...<var>args</var> )</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-performshadowrealmeval" title="
				PerformShadowRealmEval (
					sourceText: a String,
					callerRealm: a Realm Record,
					evalRealm: a Realm Record,
				)
			"><span class="secnum">3.1.3</span> 
				PerformShadowRealmEval (
					<var>sourceText</var>: a String,
					<var>callerRealm</var>: a Realm Record,
					<var>evalRealm</var>: a Realm Record,
				)
			</a></li><li><span class="item-toggle-none"></span><a href="#sec-shadowrealmimportvalue" title="
				ShadowRealmImportValue (
					specifierString: a String,
					exportNameString: a String,
					callerRealm: a Realm Record,
					evalRealm: a Realm Record,
					evalContext: an execution context,
				)
			"><span class="secnum">3.1.4</span> 
				ShadowRealmImportValue (
					<var>specifierString</var>: a String,
					<var>exportNameString</var>: a String,
					<var>callerRealm</var>: a Realm Record,
					<var>evalRealm</var>: a Realm Record,
					<var>evalContext</var>: an execution context,
				)
			</a></li><li><span class="item-toggle-none"></span><a href="#sec-getwrappedvalue" title="
				GetWrappedValue (
					callerRealm: a Realm Record,
					value: unknown,
				)
			"><span class="secnum">3.1.5</span> 
				GetWrappedValue (
					<var>callerRealm</var>: a Realm Record,
					<var>value</var>: unknown,
				)
			</a></li><li><span class="item-toggle-none"></span><a href="#sec-validateshadowrealmobject" title="
				ValidateShadowRealmObject (
					O: unknown
				)
			"><span class="secnum">3.1.6</span> 
				ValidateShadowRealmObject (
					<var>O</var>: unknown
				)
			</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-shadowrealm-constructor" title="The ShadowRealm Constructor"><span class="secnum">3.2</span> The ShadowRealm Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-shadowrealm" title="ShadowRealm ( )"><span class="secnum">3.2.1</span> ShadowRealm ( )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-properties-of-the-shadowRealm-constructor" title="Properties of the ShadowRealm Constructor"><span class="secnum">3.3</span> Properties of the ShadowRealm Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-shadowrealm.prototype" title="ShadowRealm.prototype"><span class="secnum">3.3.1</span> ShadowRealm.prototype</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-properties-of-the-shadowrealm-prototype-object" title="Properties of the ShadowRealm Prototype Object"><span class="secnum">3.4</span> Properties of the ShadowRealm Prototype Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-shadowrealm.prototype.evaluate" title="ShadowRealm.prototype.evaluate ( sourceText )"><span class="secnum">3.4.1</span> ShadowRealm.prototype.evaluate ( <var>sourceText</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shadowrealm.prototype.importvalue" title="ShadowRealm.prototype.importValue ( specifier, exportName )"><span class="secnum">3.4.2</span> ShadowRealm.prototype.importValue ( <var>specifier</var>, <var>exportName</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shadowrealm.prototype-@@tostringtag" title="ShadowRealm.prototype [ @@toStringTag ]"><span class="secnum">3.4.3</span> ShadowRealm.prototype [ @@toStringTag ]</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-properties-of-shadowrealm-instances" title="Properties of ShadowRealm Instances"><span class="secnum">3.5</span> Properties of ShadowRealm Instances</a></li><li><span class="item-toggle">◢</span><a href="#sec-shadowrealm-host-operations" title="Host operations"><span class="secnum">3.6</span> Host operations</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-host-initialize-shadow-shadowrealm" title="Runtime Semantics: HostInitializeShadowRealm ( realm )"><span class="secnum">3.6.1</span> RS: HostInitializeShadowRealm ( <var>realm</var> )</a></li></ol></li></ol></li></ol></div></div><div id="spec-container"><h1 class="version">Stage 3 Draft / April 4, 2022</h1><h1 class="title">ShadowRealm API</h1>

<emu-biblio href="./biblio.json"></emu-biblio>

<emu-clause id="sec-well-known-intrinsic-objects">
	<h1><span class="secnum">1</span> Well-known intrinsic objects</h1>
	<emu-table id="table-7" caption="Well-known Intrinsic Objects"><figure><figcaption>Table 1: Well-known Intrinsic Objects</figcaption>
		<table>
			<tbody>
				<tr>
					<th>Intrinsic Name</th>
					<th>Global Name</th>
					<th>ECMAScript Language Association</th>
				</tr>
				<tr>
					<td><emu-xref href="#sec-shadowrealm-constructor" id="_ref_6"><a href="#sec-shadowrealm-constructor">%ShadowRealm%</a></emu-xref></td>
					<td><code>ShadowRealm</code></td>
					<td>The ShadowRealm <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> (<emu-xref href="#sec-shadowrealm-constructor" id="_ref_0"><a href="#sec-shadowrealm-constructor">3.2</a></emu-xref>)</td>
				</tr>
			</tbody>
		</table>
	</figure></emu-table>
</emu-clause>

<emu-clause id="sec-wrapped-function-exotic-objects">
	<h1><span class="secnum">2</span> Wrapped Function Exotic Objects</h1>
	<p>A <emu-xref href="#wrapped-function-exotic-object" id="_ref_7"><a href="#wrapped-function-exotic-object">wrapped function exotic object</a></emu-xref> is an <emu-xref href="#exotic-object"><a href="https://tc39.es/ecma262/#exotic-object">exotic object</a></emu-xref> that wraps a callable object. A <emu-xref href="#wrapped-function-exotic-object" id="_ref_8"><a href="#wrapped-function-exotic-object">wrapped function exotic object</a></emu-xref> is callable (it has a [[Call]] internal method). Calling a <emu-xref href="#wrapped-function-exotic-object" id="_ref_9"><a href="#wrapped-function-exotic-object">wrapped function exotic object</a></emu-xref> generally results in a call of its wrapped function.</p>

	<p>An object is a <dfn id="wrapped-function-exotic-object">wrapped function exotic object</dfn> if its [[Call]] internal method uses the following implementation, and its other essential internal methods use the definitions found in <emu-xref href="#sec-ordinary-object-internal-methods-and-internal-slots"><a href="https://tc39.es/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots">9.1</a></emu-xref>. These methods are installed in <emu-xref aoid="WrappedFunctionCreate" id="_ref_10"><a href="#sec-wrappedfunctioncreate">WrappedFunctionCreate</a></emu-xref>.</p>

	<p>Wrapped function exotic objects do not have the internal slots of ECMAScript function objects listed in <emu-xref aoid="Internal Slots of ECMAScript Function Objects"><a href="https://tc39.es/ecma262/#table-internal-slots-of-ecmascript-function-objects">Internal Slots of ECMAScript Function Objects</a></emu-xref>. Instead they have the internal slots listed in <emu-xref href="#table-internal-slots-of-wrapped-function-exotic-objects" id="_ref_1"><a href="#table-internal-slots-of-wrapped-function-exotic-objects">Table 2</a></emu-xref>, in addition to [[Prototype]] and [[Extensible]].</p>
	<emu-table id="table-internal-slots-of-wrapped-function-exotic-objects" caption="Internal Slots of Wrapped Function Exotic Objects"><figure><figcaption>Table 2: Internal Slots of Wrapped Function Exotic Objects</figcaption>
	<table>
		<tbody>
		<tr>
		<th>
			Internal Slot
		</th>
		<th>
			Type
		</th>
		<th>
			Description
		</th>
		</tr>
		<tr>
		<td>
			[[WrappedTargetFunction]]
		</td>
		<td>
			Callable Object
		</td>
		<td>
			Stores the callable object.
		</td>
		</tr>
		<tr>
		<td>
			[[Call]]
		</td>
		<td>
			The [[Call]] internal method
		</td>
		<td>
			Executes code associated with this object's [[WrappedTargetFunction]].
		</td>
		</tr>
		<tr>
		<td>
			[[Realm]]
		</td>
		<td>
			<emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref>
		</td>
		<td>
			The <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">realm</a></emu-xref> in which the function was created.
		</td>
		</tr>
		</tbody>
	</table>
	</figure></emu-table>

	<emu-clause id="sec-wrapped-function-exotic-objects-call-thisargument-argumentslist" type="internal method">
		<h1><span class="secnum">2.1</span> [[Call]] ( <var>thisArgument</var>, <var>argumentsList</var> )</h1>
		<p>The [[Call]] internal method of a <emu-xref href="#wrapped-function-exotic-object" id="_ref_11"><a href="#wrapped-function-exotic-object">wrapped function exotic object</a></emu-xref> <var>F</var> takes arguments <var>thisArgument</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and <var>argumentsList</var> (a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of ECMAScript language values). It performs the following steps when called:</p>
		<emu-alg><ol><li>Let <var>target</var> be <var>F</var>.[[WrappedTargetFunction]].</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="IsCallable" id="_ref_12"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>target</var>) is <emu-val>true</emu-val>.</li><li>Let <var>targetRealm</var> be ?&nbsp;<emu-xref aoid="GetFunctionRealm" id="_ref_13"><a href="https://tc39.es/ecma262/#sec-getfunctionrealm">GetFunctionRealm</a></emu-xref>(<var>target</var>).</li><li>Let <var>callerRealm</var> be ?&nbsp;<emu-xref aoid="GetFunctionRealm" id="_ref_14"><a href="https://tc39.es/ecma262/#sec-getfunctionrealm">GetFunctionRealm</a></emu-xref>(<var>F</var>).</li><li>NOTE: Any exception objects produced after this point are associated with <var>callerRealm</var>.</li><li>Let <var>wrappedArgs</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>For each element <var>arg</var> of <var>argumentsList</var>, do<ol><li>Let <var>wrappedValue</var> be ?&nbsp;<emu-xref aoid="GetWrappedValue" id="_ref_15"><a href="#sec-getwrappedvalue">GetWrappedValue</a></emu-xref>(<var>targetRealm</var>, <var>arg</var>).</li><li>Append <var>wrappedValue</var> to <var>wrappedArgs</var>.</li></ol></li><li>Let <var>wrappedThisArgument</var> to ?&nbsp;<emu-xref aoid="GetWrappedValue" id="_ref_16"><a href="#sec-getwrappedvalue">GetWrappedValue</a></emu-xref>(<var>targetRealm</var>, <var>thisArgument</var>).</li><li>Let <var>result</var> be the <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion Record</a></emu-xref> of <emu-xref aoid="Call" id="_ref_17"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>target</var>, <var>wrappedThisArgument</var>, <var>wrappedArgs</var>).</li><li>If <var>result</var>.[[Type]] is <emu-const>normal</emu-const> or <var>result</var>.[[Type]] is <emu-const>return</emu-const>, then<ol><li>Return ?&nbsp;<emu-xref aoid="GetWrappedValue" id="_ref_18"><a href="#sec-getwrappedvalue">GetWrappedValue</a></emu-xref>(<var>callerRealm</var>, <var>result</var>.[[Value]]).</li></ol></li><li>Else,<ol><li>Throw a <emu-val>TypeError</emu-val> exception.</li></ol></li></ol></emu-alg>
		<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
			In the case of an abrupt <emu-const>throw</emu-const> completion, the type of error to be created should match the type of the abrupt throw completion record. This could be revisited when merging into the main specification. Additionally, in the case of a <emu-const>break</emu-const> or <emu-const>continue</emu-const> completion, since those are not supported, a TypeError is expected.
		</div></emu-note>
	</emu-clause>
</emu-clause>

<emu-clause id="sec-shadowrealm-objects">
	<h1><span class="secnum">3</span> ShadowRealm Objects</h1>
	<emu-clause id="sec-shadowrealm-abstracts">
		<h1><span class="secnum">3.1</span> ShadowRealm Abstract Operations</h1>

		<emu-clause id="sec-wrappedfunctioncreate" aoid="WrappedFunctionCreate" type="abstract operation">
			<h1><span class="secnum">3.1.1</span> 
				WrappedFunctionCreate (
					<var>callerRealm</var>: a Realm Record,
					<var>Target</var>: a function object,
				)
			</h1>
			<p>The abstract operation WrappedFunctionCreate takes arguments <var>callerRealm</var> and <var>Target</var>. It is used to specify the creation of new wrapped function exotic objects. It performs the following steps when called:</p>
			<emu-alg><ol><li>Let <var>internalSlotsList</var> be the internal slots listed in <emu-xref href="#table-internal-slots-of-wrapped-function-exotic-objects" id="_ref_2"><a href="#table-internal-slots-of-wrapped-function-exotic-objects">Table 2</a></emu-xref>, plus [[Prototype]] and [[Extensible]].</li><li>Let <var>wrapped</var> be !&nbsp;MakeBasicObject(<var>internalSlotsList</var>).</li><li>Set <var>wrapped</var>.[[Prototype]] to <var>callerRealm</var>.[[Intrinsics]].[[<emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>]].</li><li>Set <var>wrapped</var>.[[Call]] as described in <emu-xref href="#sec-wrapped-function-exotic-objects-call-thisargument-argumentslist" id="_ref_3"><a href="#sec-wrapped-function-exotic-objects-call-thisargument-argumentslist">2.1</a></emu-xref>.</li><li>Set <var>wrapped</var>.[[WrappedTargetFunction]] to <var>Target</var>.</li><li>Set <var>wrapped</var>.[[Realm]] to <var>callerRealm</var>.</li><li>Let <var>result</var> be <emu-xref aoid="CopyNameAndLength" id="_ref_19"><a href="#sec-copynameandlength">CopyNameAndLength</a></emu-xref>(<var>wrapped</var>, <var>Target</var>).</li><li>If <var>result</var> is an Abrupt <emu-xref aoid="Completion" id="_ref_20"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion</a></emu-xref>, throw a TypeError exception.</li><li>Return <var>wrapped</var>.</li></ol></emu-alg>
		</emu-clause>

		<emu-clause id="sec-copynameandlength" aoid="CopyNameAndLength" type="abstract operation">
			<h1><span class="secnum">3.1.2</span> 
				CopyNameAndLength (
					<var>F</var>: a function object,
					<var>Target</var>: a function object,
					optional <var>prefix</var>: a String,
					optional <var>argCount</var>: a Number,
				)
			</h1>
			<emu-alg><ol><li>If <var>argCount</var> is <emu-val>undefined</emu-val>, then set <var>argCount</var> to 0.</li><li>Let <var>L</var> be 0.</li><li>Let <var>targetHasLength</var> be ?&nbsp;<emu-xref aoid="HasOwnProperty" id="_ref_21"><a href="https://tc39.es/ecma262/#sec-hasownproperty">HasOwnProperty</a></emu-xref>(<var>Target</var>, <emu-val>"length"</emu-val>).</li><li>If <var>targetHasLength</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>targetLen</var> be ?&nbsp;<emu-xref aoid="Get" id="_ref_22"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>Target</var>, <emu-val>"length"</emu-val>).</li><li>If <emu-xref aoid="Type" id="_ref_23"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>targetLen</var>) is Number, then<ol><li>If <var>targetLen</var> is <emu-val>+∞</emu-val><sub>𝔽</sub>, set <var>L</var> to +∞.</li><li>Else if <var>targetLen</var> is <emu-val>-∞</emu-val><sub>𝔽</sub>, set <var>L</var> to 0.</li><li>Else,<ol><li>Let <var>targetLenAsInt</var> be !&nbsp;ToIntegerOrInfinity(<var>targetLen</var>).</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>targetLenAsInt</var> is finite.</li><li>Set <var>L</var> to <emu-xref aoid="max"><a href="https://tc39.es/ecma262/#eqn-max">max</a></emu-xref>(<var>targetLenAsInt</var> - <var>argCount</var>, 0).</li></ol></li></ol></li></ol></li><li>Perform !&nbsp;<emu-xref aoid="SetFunctionLength" id="_ref_24"><a href="https://tc39.es/ecma262/#sec-setfunctionlength">SetFunctionLength</a></emu-xref>(<var>F</var>, <var>L</var>).</li><li>Let <var>targetName</var> be ?&nbsp;<emu-xref aoid="Get" id="_ref_25"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>Target</var>, <emu-val>"name"</emu-val>).</li><li>If <emu-xref aoid="Type" id="_ref_26"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>targetName</var>) is not String, set <var>targetName</var> to the empty String.</li><li>Perform !&nbsp;<emu-xref aoid="SetFunctionName" id="_ref_27"><a href="https://tc39.es/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <var>targetName</var>, <var>prefix</var>).</li></ol></emu-alg>

			<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
				Function.prototype.bind can replace steps 4 to 10 with this abstraction.
			</div></emu-note>

			<emu-clause id="sec-function.prototype.bind">
				<h1><span class="secnum">3.1.2.1</span> Function.prototype.bind ( <var>thisArg</var>, ...<var>args</var> )</h1>
				<p>When the <code>bind</code> method is called with argument <var>thisArg</var> and zero or more <var>args</var>, it performs the following steps:</p>
				<emu-alg><ol><li>Let <var>Target</var> be the <emu-val>this</emu-val> value.</li><li>If <emu-xref aoid="IsCallable" id="_ref_28"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>Target</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>F</var> be ?&nbsp;<emu-xref aoid="BoundFunctionCreate" id="_ref_29"><a href="https://tc39.es/ecma262/#sec-boundfunctioncreate">BoundFunctionCreate</a></emu-xref>(<var>Target</var>, <var>thisArg</var>, <var>args</var>).</li><li><ins>Let <var>argCount</var> be the number of elements in <var>args</var>.</ins></li><li><ins>Perform ?&nbsp;<emu-xref aoid="CopyNameAndLength" id="_ref_30"><a href="#sec-copynameandlength">CopyNameAndLength</a></emu-xref>(<var>F</var>, <var>Target</var>, <emu-val>"bound"</emu-val>, <var>argCount</var>).</ins></li><li><del>Let <var>L</var> be 0.</del></li><li><del>Let <var>targetHasLength</var> be ?&nbsp;<emu-xref aoid="HasOwnProperty" id="_ref_31"><a href="https://tc39.es/ecma262/#sec-hasownproperty">HasOwnProperty</a></emu-xref>(<var>Target</var>, <emu-val>"length"</emu-val>).</del></li><li><del>If <var>targetHasLength</var> is <emu-val>true</emu-val>, then<ol><li><del>Let <var>targetLen</var> be ?&nbsp;<emu-xref aoid="Get" id="_ref_32"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>Target</var>, <emu-val>"length"</emu-val>).</del></li><li><del>If <emu-xref aoid="Type" id="_ref_33"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>targetLen</var>) is Number, then</del></li><li><del>If <var>targetLen</var> is <emu-val>+∞</emu-val><sub>𝔽</sub>, set <var>L</var> to +∞.</del></li><li><del>Else if <var>targetLen</var> is <emu-val>-∞</emu-val><sub>𝔽</sub>, set <var>L</var> to 0.</del></li><li><del>Else,<ol><li><del>Let <var>targetLenAsInt</var> be !&nbsp;ToIntegerOrInfinity(<var>targetLen</var>).</del></li><li><del><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>targetLenAsInt</var> is finite.</del></li><li><del>Let <var>argCount</var> be the number of elements in <var>args</var>.</del></li><li><del>Set <var>L</var> to <emu-xref aoid="max"><a href="https://tc39.es/ecma262/#eqn-max">max</a></emu-xref>(<var>targetLenAsInt</var> - <var>argCount</var>, 0).</del></li></ol></del></li></ol></del></li><li><del>Perform !&nbsp;<emu-xref aoid="SetFunctionLength" id="_ref_34"><a href="https://tc39.es/ecma262/#sec-setfunctionlength">SetFunctionLength</a></emu-xref>(<var>F</var>, <var>L</var>).</del></li><li><del>Let <var>targetName</var> be ?&nbsp;<emu-xref aoid="Get" id="_ref_35"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>Target</var>, <emu-val>"name"</emu-val>).</del></li><li><del>If <emu-xref aoid="Type" id="_ref_36"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>targetName</var>) is not String, set <var>targetName</var> to the empty String.</del></li><li><del>Perform <emu-xref aoid="SetFunctionName" id="_ref_37"><a href="https://tc39.es/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <var>targetName</var>, <emu-val>"bound"</emu-val>).</del></li><li>Return <var>F</var>.
				</li></ol></emu-alg>
			</emu-clause>
		</emu-clause>

		<emu-clause id="sec-performshadowrealmeval" aoid="PerformShadowRealmEval" type="abstract operation">
			<h1><span class="secnum">3.1.3</span> 
				PerformShadowRealmEval (
					<var>sourceText</var>: a String,
					<var>callerRealm</var>: a Realm Record,
					<var>evalRealm</var>: a Realm Record,
				)
			</h1>
			<emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="HostEnsureCanCompileStrings" id="_ref_38"><a href="https://tc39.es/ecma262/#sec-hostensurecancompilestrings">HostEnsureCanCompileStrings</a></emu-xref>(<var>callerRealm</var>, <var>evalRealm</var>).</li><li>Perform the following substeps in an implementation-defined order, possibly interleaving parsing and error detection:<ol><li>Let <var>script</var> be ParseText(! StringToCodePoints(<var>sourceText</var>), <emu-nt><a href="https://tc39.es/ecma262/#prod-Script">Script</a></emu-nt>).</li><li>If <var>script</var> is a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of errors, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>script</var> Contains <emu-nt><a href="https://tc39.es/ecma262/#prod-ScriptBody">ScriptBody</a></emu-nt> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>body</var> be the <emu-nt><a href="https://tc39.es/ecma262/#prod-ScriptBody">ScriptBody</a></emu-nt> of <var>script</var>.</li><li>If <var>body</var> Contains <emu-nt><a href="https://tc39.es/ecma262/#prod-NewTarget">NewTarget</a></emu-nt> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>body</var> Contains <emu-nt><a href="https://tc39.es/ecma262/#prod-SuperProperty">SuperProperty</a></emu-nt> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>body</var> Contains <emu-nt><a href="https://tc39.es/ecma262/#prod-SuperCall">SuperCall</a></emu-nt> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>Let <var>strictEval</var> be IsStrict of <var>script</var>.</li><li>Let <var>runningContext</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>lexEnv</var> be <emu-xref aoid="NewDeclarativeEnvironment" id="_ref_39"><a href="https://tc39.es/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>evalRealm</var>.[[GlobalEnv]]).</li><li>Let <var>varEnv</var> be <var>evalRealm</var>.[[GlobalEnv]].</li><li>If <var>strictEval</var> is <emu-val>true</emu-val>, set <var>varEnv</var> to <var>lexEnv</var>.</li><li>If <var>runningContext</var> is not already suspended, suspend <var>runningContext</var>.</li><li>Let <var>evalContext</var> be a new ECMAScript code <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref>.</li><li>Set <var>evalContext</var>'s Function to <emu-val>null</emu-val>.</li><li>Set <var>evalContext</var>'s <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> to <var>evalRealm</var>.</li><li>Set <var>evalContext</var>'s ScriptOrModule to <emu-val>null</emu-val>.</li><li>Set <var>evalContext</var>'s VariableEnvironment to <var>varEnv</var>.</li><li>Set <var>evalContext</var>'s LexicalEnvironment to <var>lexEnv</var>.</li><li>Push <var>evalContext</var> onto the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>; <var>evalContext</var> is now the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>result</var> be <emu-xref aoid="EvalDeclarationInstantiation" id="_ref_40"><a href="https://tc39.es/ecma262/#sec-evaldeclarationinstantiation">EvalDeclarationInstantiation</a></emu-xref>(<var>body</var>, <var>varEnv</var>, <var>lexEnv</var>, <emu-val>null</emu-val>, <var>strictEval</var>).</li><li>If <var>result</var>.[[Type]] is <emu-const>normal</emu-const>, then<ol><li>Set <var>result</var> to the result of <span class="e-user-code">evaluating <var>body</var></span>.</li></ol></li><li>If <var>result</var>.[[Type]] is <emu-const>normal</emu-const> and <var>result</var>.[[Value]] is <emu-const>empty</emu-const>, then<ol><li>Set result to <emu-xref aoid="NormalCompletion" id="_ref_41"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-val>undefined</emu-val>).</li></ol></li><li><emu-xref aoid="Suspend" id="_ref_42"><a href="https://tc39.es/ecma262/#sec-suspend">Suspend</a></emu-xref> <var>evalContext</var> and remove it from the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>.</li><li>Resume the context that is now on the top of the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref> as the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>If <var>result</var>.[[Type]] is not <emu-const>normal</emu-const>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Return ?&nbsp;<emu-xref aoid="GetWrappedValue" id="_ref_43"><a href="#sec-getwrappedvalue">GetWrappedValue</a></emu-xref>(<var>callerRealm</var>, <var>result</var>.[[Value]]).</li></ol></emu-alg>
			<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
				In the case of an abrupt <emu-const>throw</emu-const> completion, the type of error to be created should match the type of the abrupt throw completion record. This could be revisited when merging into the main specification. Additionally, in the case of a <emu-const>break</emu-const> or <emu-const>continue</emu-const> completion, since those are not supported, a TypeError is expected. There should be no <emu-const>return</emu-const> completion because this is a top level script evaluation, in which case a return <emu-nt><a href="https://tc39.es/ecma262/#prod-Statement">Statement</a></emu-nt> must result in a parsing error.
			</div></emu-note>
			<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
				Some steps from PerformShadowRealmEval are shared with <emu-nt>eval</emu-nt> and <emu-nt>Function</emu-nt> and should result into a shared abstraction when merged to ECMA-262.
			</div></emu-note>
			<emu-note><span class="note">Note</span><div class="note-contents">
				This abstraction requires the performed evaluation to result into a normal completion. Otherwise, if the result is not a normal completion, the abstraction will throw a TypeError exception associated to its original <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.
			</div></emu-note>
		</emu-clause>

		<emu-clause id="sec-shadowrealmimportvalue" aoid="ShadowRealmImportValue" type="abstract operation">
			<h1><span class="secnum">3.1.4</span> 
				ShadowRealmImportValue (
					<var>specifierString</var>: a String,
					<var>exportNameString</var>: a String,
					<var>callerRealm</var>: a Realm Record,
					<var>evalRealm</var>: a Realm Record,
					<var>evalContext</var>: an execution context,
				)
			</h1>
			<emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>evalContext</var> is an <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref> associated to a ShadowRealm instance's [[ExecutionContext]].</li><li>Let <var>innerCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability" id="_ref_44"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Let <var>runningContext</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>If <var>runningContext</var> is not already suspended, suspend <var>runningContext</var>.</li><li>Push <var>evalContext</var> onto the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>; <var>evalContext</var> is now the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Perform !&nbsp;<emu-xref aoid="HostImportModuleDynamically" id="_ref_45"><a href="https://tc39.es/ecma262/#sec-hostimportmoduledynamically">HostImportModuleDynamically</a></emu-xref>(<emu-val>null</emu-val>, <var>specifierString</var>, <var>innerCapability</var>).</li><li><emu-xref aoid="Suspend" id="_ref_46"><a href="https://tc39.es/ecma262/#sec-suspend">Suspend</a></emu-xref> <var>evalContext</var> and remove it from the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref>.</li><li>Resume the context that is now on the top of the <emu-xref href="#execution-context-stack"><a href="https://tc39.es/ecma262/#execution-context-stack">execution context stack</a></emu-xref> as the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>steps</var> be the steps of an ExportGetter function as described below.</li><li>Let <var>onFulfilled</var> be !&nbsp;<emu-xref aoid="CreateBuiltinFunction" id="_ref_47"><a href="https://tc39.es/ecma262/#sec-createbuiltinfunction">CreateBuiltinFunction</a></emu-xref>(<var>steps</var>, 1, <emu-val>""</emu-val>, « [[ExportNameString]] », <var>callerRealm</var>).</li><li>Set <var>onFulfilled</var>.[[ExportNameString]] to <var>exportNameString</var>.</li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability" id="_ref_48"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Return !&nbsp;<emu-xref aoid="PerformPromiseThen" id="_ref_49"><a href="https://tc39.es/ecma262/#sec-performpromisethen">PerformPromiseThen</a></emu-xref>(<var>innerCapability</var>.[[Promise]], <var>onFulfilled</var>, <var>callerRealm</var>.[[Intrinsics]].[[<emu-xref href="#sec-%throwtypeerror%"><a href="https://tc39.es/ecma262/#sec-%throwtypeerror%">%ThrowTypeError%</a></emu-xref>]], <var>promiseCapability</var>).</li></ol></emu-alg>

			<p>An ExportGetter function is an anonymous built-in function with a [[ExportNameString]] internal slot. When an ExportGetter function is called with argument <var>exports</var>, it performs the following steps:</p>
			<emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>exports</var> is a module namespace <emu-xref href="#exotic-object"><a href="https://tc39.es/ecma262/#exotic-object">exotic object</a></emu-xref>.</li><li>Let <var>f</var> be the <emu-xref href="#active-function-object"><a href="https://tc39.es/ecma262/#active-function-object">active function object</a></emu-xref>.</li><li>Let <var>string</var> be <var>f</var>.[[ExportNameString]].</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type" id="_ref_50"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>string</var>) is String.</li><li>Let <var>hasOwn</var> be ?&nbsp;<emu-xref aoid="HasOwnProperty" id="_ref_51"><a href="https://tc39.es/ecma262/#sec-hasownproperty">HasOwnProperty</a></emu-xref>(<var>exports</var>, <var>string</var>).</li><li>If <var>hasOwn</var> is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="Get" id="_ref_52"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>exports</var>, <var>string</var>).</li><li>Let <var>realm</var> be <var>f</var>.[[Realm]].</li><li>Return ?&nbsp;<emu-xref aoid="GetWrappedValue" id="_ref_53"><a href="#sec-getwrappedvalue">GetWrappedValue</a></emu-xref>(<var>realm</var>, <var>value</var>).</li></ol></emu-alg>
		</emu-clause>

		<emu-clause id="sec-getwrappedvalue" aoid="GetWrappedValue" type="abstract operation">
			<h1><span class="secnum">3.1.5</span> 
				GetWrappedValue (
					<var>callerRealm</var>: a Realm Record,
					<var>value</var>: unknown,
				)
			</h1>
			<emu-alg><ol><li>If <emu-xref aoid="Type" id="_ref_54"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>value</var>) is Object, then<ol><li>If <emu-xref aoid="IsCallable" id="_ref_55"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>value</var>) is <emu-val>false</emu-val>, throw a TypeError exception.</li><li>Return ?&nbsp;<emu-xref aoid="WrappedFunctionCreate" id="_ref_56"><a href="#sec-wrappedfunctioncreate">WrappedFunctionCreate</a></emu-xref>(<var>callerRealm</var>, <var>value</var>).</li></ol></li><li>Return <var>value</var>.</li></ol></emu-alg>
		</emu-clause>

		<emu-clause id="sec-validateshadowrealmobject" aoid="ValidateShadowRealmObject" type="abstract operation">
			<h1><span class="secnum">3.1.6</span> 
				ValidateShadowRealmObject (
					<var>O</var>: unknown
				)
			</h1>
			<emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot" id="_ref_57"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[ShadowRealm]]).</li><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot" id="_ref_58"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[ExecutionContext]]).</li></ol></emu-alg>
		</emu-clause>
	</emu-clause>

	<emu-clause id="sec-shadowrealm-constructor">
		<h1><span class="secnum">3.2</span> The ShadowRealm Constructor</h1>
		<p>The ShadowRealm <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
		<ul>
			<li>is the intrinsic object <dfn>%ShadowRealm%</dfn>.</li>
			<li>is the initial value of the <emu-val>"ShadowRealm"</emu-val> property of the <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref>.</li>
			<li>is not intended to be called as a function and will throw an exception when called in that manner.</li>
			<li>creates and initializes a new ShadowRealm object when called as a <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>.</li>
			<li>is designed to be subclassable. It may be used as the value in an <code>extends</code> clause of a class definition. Subclass constructors that intend to inherit the specified <code>ShadowRealm</code> behaviour must include a <code>super</code> call to the <code>ShadowRealm</code> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> to create and initialize the subclass instance with the internal state necessary to support the <code>ShadowRealm.prototype</code> built-in methods.</li>
		</ul>

		<emu-clause id="sec-shadowrealm">
			<h1><span class="secnum">3.2.1</span> ShadowRealm ( )</h1>
			<p>When the <code>ShadowRealm</code> function is called, the following steps are taken:</p>
			<emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>O</var> be ?&nbsp;<emu-xref aoid="OrdinaryCreateFromConstructor" id="_ref_59"><a href="https://tc39.es/ecma262/#sec-ordinarycreatefromconstructor">OrdinaryCreateFromConstructor</a></emu-xref>(NewTarget, <emu-val>"%ShadowRealm.prototype%"</emu-val>, « [[ShadowRealm]], [[ExecutionContext]] »).</li><li>Let <var>realmRec</var> be <emu-xref aoid="CreateRealm" id="_ref_60"><a href="https://tc39.es/ecma262/#sec-createrealm">CreateRealm</a></emu-xref>().</li><li>Set <var>O</var>.[[ShadowRealm]] to <var>realmRec</var>.</li><li>Let <var>context</var> be a new <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref>.</li><li>Set the Function of <var>context</var> to <emu-val>null</emu-val>.</li><li>Set the <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> of <var>context</var> to <var>realmRec</var>.</li><li>Set the ScriptOrModule of <var>context</var> to <emu-val>null</emu-val>.</li><li>Set <var>O</var>.[[ExecutionContext]] to <var>context</var>.</li><li>Perform ?&nbsp;<emu-xref aoid="SetRealmGlobalObject" id="_ref_61"><a href="https://tc39.es/ecma262/#sec-setrealmglobalobject">SetRealmGlobalObject</a></emu-xref>(<var>realmRec</var>, <emu-val>undefined</emu-val>, <emu-val>undefined</emu-val>).</li><li>Perform ?&nbsp;<emu-xref aoid="SetDefaultGlobalBindings" id="_ref_62"><a href="https://tc39.es/ecma262/#sec-setdefaultglobalbindings">SetDefaultGlobalBindings</a></emu-xref>(<var>O</var>.[[ShadowRealm]]).</li><li>Perform ?&nbsp;<emu-xref aoid="HostInitializeShadowRealm" id="_ref_63"><a href="#sec-host-initialize-shadow-shadowrealm">HostInitializeShadowRealm</a></emu-xref>(<var>O</var>.[[ShadowRealm]]).</li><li>Return <var>O</var>.</li></ol></emu-alg>
		</emu-clause>
	</emu-clause>

	<emu-clause id="sec-properties-of-the-shadowRealm-constructor">
		<h1><span class="secnum">3.3</span> Properties of the ShadowRealm Constructor</h1>
		<p>The ShadowRealm <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
		<ul>
			<li>has a [[Prototype]] internal slot whose value is <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li>
			<li>has the following properties:</li>
		</ul>

		<emu-clause id="sec-shadowrealm.prototype">
			<h1><span class="secnum">3.3.1</span> ShadowRealm.prototype</h1>
			<p>The initial value of <emu-val>ShadowRealm.prototype</emu-val> is %ShadowRealm.prototype%.</p>
			<p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val> }.</p>
		</emu-clause>
	</emu-clause>

	<emu-clause id="sec-properties-of-the-shadowrealm-prototype-object">
		<h1><span class="secnum">3.4</span> Properties of the ShadowRealm Prototype Object</h1>
		<p>The ShadowRealm prototype object:</p>
		<ul>
			<li>has a [[Prototype]] internal slot whose value is <dfn>%Object.prototype%</dfn>.</li>
			<li>is %ShadowRealm.prototype%.</li>
			<li>is an ordinary object.</li>
			<li>does not have a [[ShadowRealm]] or any other of the internal slots that are specific to <var>Realm</var> instance objects.</li>
		</ul>

		<emu-clause id="sec-shadowrealm.prototype.evaluate">
			<h1><span class="secnum">3.4.1</span> ShadowRealm.prototype.evaluate ( <var>sourceText</var> )</h1>

			<p>Synchronously execute a top-level script. The <var>sourceText</var> is interpreted as a Script and evaluated with this bound to the shadowrealm's <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref>.</p>

			<emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;<emu-xref aoid="ValidateShadowRealmObject" id="_ref_64"><a href="#sec-validateshadowrealmobject">ValidateShadowRealmObject</a></emu-xref>(<var>O</var>).</li><li>If <emu-xref aoid="Type" id="_ref_65"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>sourceText</var>) is not String, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>callerRealm</var> be <emu-xref href="#current-realm"><a href="https://tc39.es/ecma262/#current-realm">the current Realm Record</a></emu-xref>.</li><li>Let <var>evalRealm</var> be <var>O</var>.[[ShadowRealm]].</li><li>Return ?&nbsp;<emu-xref aoid="PerformShadowRealmEval" id="_ref_66"><a href="#sec-performshadowrealmeval" class="e-user-code">PerformShadowRealmEval</a></emu-xref>(<var>sourceText</var>, <var>callerRealm</var>, <var>evalRealm</var>).</li></ol></emu-alg>

			<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
				Extensible web: This is the dynamic equivalent of a &lt;script&gt; in HTML.
			</div></emu-note>
		</emu-clause>

		<emu-clause id="sec-shadowrealm.prototype.importvalue">
			<h1><span class="secnum">3.4.2</span> ShadowRealm.prototype.importValue ( <var>specifier</var>, <var>exportName</var> )</h1>
			<p>The following steps are performed:</p>
			<emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;<emu-xref aoid="ValidateShadowRealmObject" id="_ref_67"><a href="#sec-validateshadowrealmobject">ValidateShadowRealmObject</a></emu-xref>(<var>O</var>).</li><li>Let <var>specifierString</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_68"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>specifier</var>).</li><li>If <emu-xref aoid="Type" id="_ref_69"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>exportName</var>) is not String, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>callerRealm</var> be <emu-xref href="#current-realm"><a href="https://tc39.es/ecma262/#current-realm">the current Realm Record</a></emu-xref>.</li><li>Let <var>evalRealm</var> be <var>O</var>.[[ShadowRealm]].</li><li>Let <var>evalContext</var> be <var>O</var>.[[ExecutionContext]].</li><li>Return ?&nbsp;<emu-xref aoid="ShadowRealmImportValue" id="_ref_70"><a href="#sec-shadowrealmimportvalue">ShadowRealmImportValue</a></emu-xref>(<var>specifierString</var>, <var>exportName</var>, <var>callerRealm</var>, <var>evalRealm</var>, <var>evalContext</var>).</li></ol></emu-alg>

			<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
				Extensible web: This is equivalent to dynamic import without having to evaluate a script source, which might not be available (e.g.: when CSP is blocking source evaluation).
			</div></emu-note>
		</emu-clause>

		<emu-clause id="sec-shadowrealm.prototype-@@tostringtag">
			<h1><span class="secnum">3.4.3</span> ShadowRealm.prototype [ @@toStringTag ]</h1>
			<p>The initial value of the @@toStringTag property is the String value <emu-val>"ShadowRealm"</emu-val>.</p>
			<p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>true</emu-val> }.</p>
		</emu-clause>
	</emu-clause>

	<emu-clause id="sec-properties-of-shadowrealm-instances">
		<h1><span class="secnum">3.5</span> Properties of ShadowRealm Instances</h1>
		<p>ShadowRealm instances are ordinary objects that inherit properties from the ShadowRealm prototype object (the intrinsic, %ShadowRealm.prototype%). ShadowRealm instances are initially created with the internal slots described in <emu-xref href="#table-internal-slots-of-shadowrealm-instances" id="_ref_4"><a href="#table-internal-slots-of-shadowrealm-instances">Table 3</a></emu-xref>.</p>

		<emu-table id="table-internal-slots-of-shadowrealm-instances" caption="Internal Slots of ShadowRealm Instances"><figure><figcaption>Table 3: Internal Slots of ShadowRealm Instances</figcaption>
			<table>
				<tbody>
					<tr>
						<th>Internal Slot</th>
						<th>Type</th>
						<th>Description</th>
					</tr>
					<tr>
						<td>[[ShadowRealm]]</td>
						<td><emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref></td>
						<td>The <emu-xref href="#realm-record"><a href="https://tc39.es/ecma262/#realm-record">Realm Record</a></emu-xref> for the initial <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref>.</td>
					</tr>
					<tr>
						<td>[[ExecutionContext]]</td>
						<td><emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">Execution context</a></emu-xref></td>
						<td>An <emu-xref href="#sec-execution-contexts"><a href="https://tc39.es/ecma262/#sec-execution-contexts">execution context</a></emu-xref> wherein the current <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> is this [[ShadowRealm]].</td>
					</tr>
				</tbody>
			</table>
		</figure></emu-table>
	</emu-clause>

	<emu-clause id="sec-shadowrealm-host-operations">
		<h1><span class="secnum">3.6</span> Host operations</h1>
		<emu-clause id="sec-host-initialize-shadow-shadowrealm" aoid="HostInitializeShadowRealm">
			<h1><span class="secnum">3.6.1</span> Runtime Semantics: HostInitializeShadowRealm ( <var>realm</var> )</h1>
			<p>
				HostInitializeShadowRealm is an implementation-defined abstract
				operation used to inform the host of any newly created realms from
				the ShadowRealm <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>. Its return value is not used, though it may
				throw an exception. The idea of this hook is to initialize host
				data structures related to the ShadowRealm, e.g., for module loading.
			</p>
			<p>
				The host may use this hook to add properties to the ShadowRealm's <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global
				object</a></emu-xref>. Those properties must be configurable.
			</p>
			<emu-note><span class="note">Note</span><div class="note-contents">
				<p>
					This specification does not recommend any specific addition.
					In the Web embedding, HTML and WebIDL will specify which
					interfaces are included. The Web Platform and Web-like
					environments may decide to include <code>EventTarget</code>,
					<code>atob</code>, <code>TextEncoder</code>, <code>URL</code>, etc. while at the same time not
					including <code>HTMLElement</code>, <code>console</code>, <code>localStorage</code>, <code>fetch</code>, etc..
				</p>
			</div></emu-note>
			<emu-note type="editor"><span class="note">Editor's Note</span><div class="note-contents">
				<p>
					The ShadowRealm <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> (<emu-xref href="#sec-shadowrealm" id="_ref_5"><a href="#sec-shadowrealm">3.2.1</a></emu-xref>
					creates a new <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref> as an ordinary object. This
					means all properties from the <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref> are deletable.
				</p>
			</div></emu-note>
		</emu-clause>
	</emu-clause>

</emu-clause>


</div></body></html>