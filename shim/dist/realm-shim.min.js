(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.Realm=b()})(this,function(){'use strict';function a(a){if(!Array.isArray(a))return'';if(a.contains('eval'))throw new Error;return`const {${a.join(',')}} = arguments[0];`}function b(b,c){const{unsafeFunction:d}=b,e=a(c);return d(`
    with (arguments[0]) {
      ${e}
      return function() {
        'use strict';
        return eval(arguments[0]);
      };
    }
  `)}function c(a){const{unsafeRec:b,globalObject:c}=a,d=new D(b),e=new Proxy(c,d),f=b.scopedEvaluatorFactory(e),g={eval(a){d.useUnsafeEvaluator=!0;try{return f.call(c,a)}finally{d.useUnsafeEvaluator=!1}}}.eval,{unsafeGlobal:h,unsafeFunction:i}=b;return C(g,i.prototype),x(g,h.Symbol.toStringTag,{value:'function eval() { [shim code] }',writable:!1,enumerable:!1,configurable:!0}),g}function d(a,b,c){const d=function(...b){const d=`${b.pop()}`||'';let e=`${b.join(',')}`;if(new a(d),e.includes(')'))throw new SyntaxError('Function arg string contains parenthesis');0<e.length&&(e+='\n/*``*/');const f=`(function(${e}){\n${d}\n})`;return c(f)};return C(d,a.prototype),x(d,'prototype',{value:a.prototype}),x(d,b.Symbol.toStringTag,{value:'function Function() { [shim code] }',writable:!1,enumerable:!1,configurable:!0}),d}function e(a){const{unsafeGlobal:b}=a;s(b.Object.prototype,{__defineGetter__:{value(a,b){return x(this,a,{get:b,enumerable:!0,configurable:!0})}},__defineSetter__:{value(a,b){return x(this,a,{set:b,enumerable:!0,configurable:!0})}},__lookupGetter__:{value(a){let b,c=this;for(;c&&!(b=z(c,a));)c=A(c);return b&&b.get}},__lookupSetter__:{value(a){let b,c=this;for(;c&&!(b=z(c,a));)c=A(c);return b&&b.set}}})}function f(a,b,c){const{unsafeEval:d,unsafeFunction:e,unsafeGlobal:f}=a;let g;try{g=d(`(${c}(){})`)}catch(a){if(!(a instanceof f.SyntaxError))throw a;return}const h=A(g),i=e('throw new Error("Not available");');s(i,{name:{value:b},prototype:{value:h}}),x(h,'constructor',{value:i}),C(i,e.prototype.constructor)}function g(a){f(a,'Function','function'),f(a,'GeneratorFunction','function*'),f(a,'AsyncFunction','async function'),f(a,'AsyncGeneratorFunction','async function*')}function h(a){e(a),g(a)}function i(a){void 0===a&&(a=H());const c={unsafeGlobal:a.global,unsafeEval:a.eval,unsafeFunction:a.Function};return c.scopedEvaluatorFactory=b(c),h(c),c}function j(){return(0,eval)(G)}function k(a,b){const c={Infinity:{value:Infinity},NaN:{value:NaN},undefined:{value:void 0}},d=['isFinite','isNaN','parseFloat','parseInt','decodeURI','decodeURIComponent','encodeURI','encodeURIComponent','Array','ArrayBuffer','Boolean','DataView','Date','Error','EvalError','Float32Array','Float64Array','Int8Array','Int16Array','Int32Array','Map','Number','Object','Promise','Proxy','RangeError','ReferenceError','RegExp','Set','String','Symbol','SyntaxError','TypeError','Uint8Array','Uint8ClampedArray','Uint16Array','Uint32Array','URIError','WeakMap','WeakSet','JSON','Math','Reflect','escape','unescape','Intl','Realm'];for(const e of d)c[e]={value:a[e],writable:!0,configurable:!0};return c.eval={value:b.eval,writable:!0,configurable:!0},c.Function={value:b.Function,writable:!0,configurable:!0},c}function l(a){const b=a,c=b.Symbol.iterator,d=new b.Array()[c](),e=A(d),f=A(e);let g;try{g=b.eval('(async function(){})')}catch(a){if(!(a instanceof b.SyntaxError))throw a}const h=g&&A(g);let i;try{i=b.eval('(function*(){})')}catch(a){if(!(a instanceof b.SyntaxError))throw a}const j=i&&A(i),k=i&&j.prototype;let l;try{l=b.eval('(async function*(){})')}catch(a){if(!(a instanceof b.SyntaxError))throw a}const m=l&&A(l),n=l&&m.prototype,o=l&&A(n),p=new b.Map()[c](),q=A(p),r=new b.Set()[c](),s=A(r),t=new b.String()[c](),u=A(t),v=b.eval('(function () { "use strict"; return Object.getOwnPropertyDescriptor(arguments, "callee").get; })()'),w=A(b.Int8Array),x=w.prototype,y={Array:b.Array,ArrayBuffer:b.ArrayBuffer,ArrayBufferPrototype:b.ArrayBuffer.prototype,ArrayIteratorPrototype:e,ArrayPrototype:b.Array.prototype,ArrayProto_entries:b.Array.prototype.entries,ArrayProto_foreach:b.Array.prototype.forEach,ArrayProto_keys:b.Array.prototype.forEach,ArrayProto_values:b.Array.prototype.values,AsyncFunctionPrototype:h,AsyncGeneratorPrototype:n,AsyncIteratorPrototype:o,Boolean:b.Boolean,BooleanPrototype:b.Boolean.prototype,DataView:b.DataView,DataViewPrototype:b.DataView.prototype,Date:b.Date,DatePrototype:b.Date.prototype,decodeURI:b.decodeURI,decodeURIComponent:b.decodeURIComponent,encodeURI:b.encodeURI,encodeURIComponent:b.encodeURIComponent,Error:b.Error,ErrorPrototype:b.Error.prototype,EvalError:b.EvalError,EvalErrorPrototype:b.EvalError.prototype,Float32Array:b.Float32Array,Float32ArrayPrototype:b.Float32Array.prototype,Float64Array:b.Float64Array,Float64ArrayPrototype:b.Float64Array.prototype,FunctionPrototype:b.Function.prototype,GeneratorPrototype:k,Int8Array:b.Int8Array,Int8ArrayPrototype:b.Int8Array.prototype,Int16Array:b.Int16Array,Int16ArrayPrototype:b.Int16Array.prototype,Int32Array:b.Int32Array,Int32ArrayPrototype:b.Int32Array.prototype,isFinite:b.isFinite,isNaN:b.isNaN,IteratorPrototype:f,JSON:b.JSON,JSONParse:b.JSON.parse,Map:b.Map,MapIteratorPrototype:q,MapPrototype:b.Map.prototype,Math:b.Math,Number:b.Number,NumberPrototype:b.Number.prototype,Object:b.Object,ObjectPrototype:b.Object.prototype,ObjProto_toString:b.Object.prototype.toString,ObjProto_valueOf:b.Object.prototype.valueOf,parseFloat:b.parseFloat,parseInt:b.parseInt,Promise:b.Promise,Promise_all:b.Promise.all,Promise_reject:b.Promise.reject,Promise_resolve:b.Promise.resolve,PromiseProto_then:b.Promise.prototype.then,PromisePrototype:b.Promise.prototype,Proxy:b.Proxy,RangeError:b.RangeError,RangeErrorPrototype:b.RangeError.prototype,ReferenceError:b.ReferenceError,ReferenceErrorPrototype:b.ReferenceError.prototype,Reflect:b.Reflect,RegExp:b.RegExp,RegExpPrototype:b.RegExp.prototype,Set:b.Set,SetIteratorPrototype:s,SetPrototype:b.Set.prototype,String:b.String,StringIteratorPrototype:u,StringPrototype:b.String.prototype,Symbol:b.Symbol,SymbolPrototype:b.Symbol.prototype,SyntaxError:b.SyntaxError,SyntaxErrorPrototype:b.SyntaxError.prototype,ThrowTypeError:v,TypedArray:w,TypedArrayPrototype:x,TypeError:b.TypeError,TypeErrorPrototype:b.TypeError.prototype,Uint8Array:b.Uint8Array,Uint8ArrayPrototype:b.Uint8Array.prototype,Uint8ClampedArray:b.Uint8ClampedArray,Uint8ClampedArrayPrototype:b.Uint8ClampedArray.prototype,Uint16Array:b.Uint16Array,Uint16ArrayPrototype:b.Uint16Array.prototype,Uint32Array:b.Uint32Array,Uint32ArrayPrototype:b.Uint32Array.prototype,URIError:b.URIError,URIErrorPrototype:b.URIError.prototype,WeakMap:b.WeakMap,WeakMapPrototype:b.WeakMap.prototype,WeakSet:b.WeakSet,WeakSetPrototype:b.WeakSet.prototype,escape:b.escape,unescape:b.unescape,Intl:b.Intl,Realm:b.Realm};return y}function m(a,b){const{unsafeEval:c,unsafeGlobal:d}=a,e=c(K)(b);d.Realm=e,J.set(e.prototype,a)}function n(a){return r(a.ObjectPrototype)}function o(a){const b=c(a),e=d(a.unsafeRec.unsafeFunction,a.unsafeRec.unsafeGlobal,b);a.safeEvaluators={eval:b,Function:e}}function p(a){const b=a.sharedIntrinsics,c=a.safeEvaluators,d=k(b,c);s(a.globalObject,d)}const{assign:q,create:r,defineProperties:s,freeze:t,getOwnPropertyDescriptors:u,getOwnPropertyNames:v}=Object,{apply:w,defineProperty:x,deleteProperty:y,getOwnPropertyDescriptor:z,getPrototypeOf:A,ownKeys:B,setPrototypeOf:C}=Reflect;class D{constructor(a){this.unsafeGlobal=a.unsafeGlobal,this.unsafeEval=a.unsafeGlobal.eval,this.useUnsafeEvaluator=!1}get(a,b){return'eval'===b?this.useUnsafeEvaluator?(this.useUnsafeEvaluator=!1,this.unsafeEval):a.eval:b in a?a[b]:void 0}has(a,b){return'eval'===b||'arguments'!==b&&(!!(b in a)||!!(b in this.unsafeGlobal))}}const E='object'==typeof exports&&'undefined'!=typeof module,F=E?require('vm'):void 0,G='({ global: this, eval, Function })',H=E?function(){const a=F.runInNewContext(G);return a}:function(){const a=document.createElement('iframe');a.style.display='none',document.body.appendChild(a);const b=a.contentWindow.eval(G);return b},I=new WeakMap,J=new WeakMap,K=`(${function(a){function b(a){try{return a()}catch(a){if(Object(a)!==a)throw a;let b,d;try{b=`${a.name}`,d=`${a.message}`}catch(a){throw new Error('Something bad happened')}const e=c.get(b)||Error;throw new e(d)}}const c=new Map([['EvalError',EvalError],['RangeError',RangeError],['ReferenceError',ReferenceError],['SyntaxError',SyntaxError],['TypeError',TypeError],['URIError',URIError]]),d=Object.getOwnPropertyDescriptors(a.prototype);class e{constructor(...c){return b(()=>Reflect.construct(a,c,e))}get intrinsics(){return b(()=>d.intrinsics.get.apply(this))}get global(){return b(()=>d.global.get.apply(this))}evaluate(...a){return b(()=>d.evaluate.value.apply(this,a))}static makeRootRealm(){return new e}static makeCompartment(){return new e({transform:'inherit',isDirectEval:'inherit',intrinsics:'inherit'})}}return Object.defineProperty(e.prototype,Symbol.toStringTag,{value:'function Realm() { [shim code] }',writable:!1,enumerable:!1,configurable:!0}),e}})`;class L{constructor(a){const b=this;if(a=Object(a),void 0!==a.thisValue)throw new TypeError('Realm only supports undefined thisValue.');let c;if('inherit'===a.intrinsics&&'inherit'===a.isDirectEval&&'inherit'===a.transform)c=J.get(A(this));else if(void 0===a.intrinsics&&void 0===a.isDirectEval&&void 0===a.transform)c=i(),m(c,L);else throw new TypeError('Realm only supports undefined or "inherited" intrinsics.');const d=l(c.unsafeGlobal),e=n(d),f={unsafeRec:c,sharedIntrinsics:d,globalObject:e,safeEvaluators:void 0};I.set(b,f),o(f),p(f)}get intrinsics(){const a=this;if('object'!=typeof a)throw new TypeError;if(!I.has(a))throw new TypeError;const b=I.get(a),c=b.sharedIntrinsics,d=r(c.ObjectPrototype);return q(d,c)}get global(){const a=this;if('object'!=typeof a)throw new TypeError;if(!I.has(a))throw new TypeError;const b=I.get(a);return b.globalObject}evaluate(a){const b=this;if('object'!=typeof b)throw new TypeError;if(!I.has(b))throw new TypeError;const c=I.get(b),d=c.safeEvaluators.eval;return d(`${a}`)}static makeRootRealm(){return new L}static makeCompartment(){return new L({transform:'inherit',isDirectEval:'inherit',intrinsics:'inherit'})}}return J.set(L.prototype,function(){const a=j();return i(a)}()),x(L.prototype,Symbol.toStringTag,{value:'function Realm() { [shim code] }',writable:!1,enumerable:!1,configurable:!0}),L});
//# sourceMappingURL=realm-shim.min.js.map
