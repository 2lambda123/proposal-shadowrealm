(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.Realm=b()})(this,function(){'use strict';function a(a){if(!Array.isArray(a))return'';if(a.contains('eval'))throw new Error;return`const {${a.join(',')}} = arguments[0];`}function b(b,c){const{contextFunction:d}=b,e=a(c);return d(`
    with (arguments[0]) {
      ${e}
      return function() {
        'use strict';
        return eval(arguments[0]);
      };
    }
  `)}function c(a){const{[u]:b,[s]:c}=a,d=new I(b),e=new Proxy(c,d),f=b.evalEvaluatorFactory(e),g={eval(a){d.isInternalEvaluation=!0;const b=f.call(c,a);return d.isInternalEvaluation=!1,b}}.eval,{contextGlobal:h,contextFunction:i}=b;return H(g,i.prototype.constructor),C(g.prototype,h.Symbol.toStringTag,{value:'function eval() { [shim code] }',writable:!1,enumerable:!1,configurable:!0}),g}function d(a){const{[u]:b,[r]:c}=a,d=function(...a){const b=a.pop()||'';let d=a.join(',');if(d.includes(')'))throw new Error('Function arg string contains parenthesis');0<d.length&&(d+='\n/*``*/');const e=`(function(${d}){\n${b}\n})`;return c.eval(e)},{contextGlobal:e,contextFunction:f}=b;H(d,f.prototype.constructor);const g=E(d,'prototype');return g.value=f.prototype,C(d,'prototype',g),C(d.prototype,e.Symbol.toStringTag,{value:'function Function() { [shim code] }',writable:!1,enumerable:!1,configurable:!0}),d}function e(a){const{contextGlobal:b}=a;x(b.Object.prototype,{__defineGetter__:{value(a,b){return C(this,a,{get:b,enumerable:!0,configurable:!0})}},__defineSetter__:{value(a,b){return C(this,a,{set:b,enumerable:!0,configurable:!0})}},__lookupGetter__:{value(a){let b,c=this;for(;c&&!(b=E(c,a));)c=F(c);return b&&b.get}},__lookupSetter__:{value(a){let b,c=this;for(;c&&!(b=E(c,a));)c=F(c);return b&&b.set}}})}function f(a,b,c){const{contextEval:d,contextFunction:e,contextGlobal:f}=a;let g;try{g=d(`(${c}(){})`)}catch(a){if(!(a instanceof f.SyntaxError))throw a;return}const h=F(g),i=e('throw new Error("Not available");');x(i,{name:{value:b},prototype:{value:h}}),C(h,'constructor',{value:i}),H(i,e.prototype.constructor)}function g(a){f(a,'Function','function'),f(a,'GeneratorFunction','function*'),f(a,'AsyncFunction','async function'),f(a,'AsyncGeneratorFunction','async function*')}function h(a){e(a),g(a)}function i(a){void 0===a&&(a=M());const c={contextGlobal:a.global,contextEval:a.eval,contextFunction:a.Function};return c.evalEvaluatorFactory=b(c),h(c),c}function j(){return(0,eval)(L)}function k(a){const b=a;return{Infinity:{value:Infinity},NaN:{value:NaN},undefined:{value:void 0},eval:{value:b.eval,writable:!0},isFinite:{value:b.isFinite},isNaN:{value:b.isNaN},parseFloat:{value:b.parseFloat},parseInt:{value:b.parseInt},decodeURI:{value:b.decodeURI},decodeURIComponent:{value:b.decodeURIComponent},encodeURI:{value:b.encodeURI},encodeURIComponent:{value:b.encodeURIComponent},Array:{value:b.Array},ArrayBuffer:{value:b.ArrayBuffer},Boolean:{value:b.Boolean},DataView:{value:b.DataView},Date:{value:b.Date},Error:{value:b.Error},EvalError:{value:b.EvalError},Float32Array:{value:b.Float32Array},Float64Array:{value:b.Float64Array},Function:{value:b.Function},Int8Array:{value:b.Int8Array},Int16Array:{value:b.Int16Array},Int32Array:{value:b.Int32Array},Map:{value:b.Map},Number:{value:b.Number},Object:{value:b.Object},Promise:{value:b.Promise},Proxy:{value:b.Proxy},RangeError:{value:b.RangeError},ReferenceError:{value:b.ReferenceError},RegExp:{value:b.RegExp},Set:{value:b.Set},String:{value:b.String},Symbol:{value:b.Symbol},SyntaxError:{value:b.SyntaxError},TypeError:{value:b.TypeError},Uint8Array:{value:b.Uint8Array},Uint8ClampedArray:{value:b.Uint8ClampedArray},Uint16Array:{value:b.Uint16Array},Uint32Array:{value:b.Uint32Array},URIError:{value:b.URIError},WeakMap:{value:b.WeakMap},WeakSet:{value:b.WeakSet},JSON:{value:b.JSON},Math:{value:b.Math},Reflect:{value:b.Reflect},escape:{value:b.escape},unescape:{value:b.unescape},Intl:{value:b.Intl},Realm:{value:b.Realm}}}function l(a){const{contextGlobal:b}=a,c=b.Symbol.iterator,d=new b.Array()[c](),e=F(d),f=F(e),g=b.eval('(async function(){})'),h=g.constructor,i=h.prototype;let j;try{j=b.eval('(function*(){})')}catch(a){if(!(a instanceof b.SyntaxError))throw a}const k=j&&j.constructor,l=j&&k.prototype,m=j&&l.prototype;let n;try{n=b.eval('(async function*(){})')}catch(a){if(!(a instanceof b.SyntaxError))throw a}const o=n&&n.constructor,p=n&&o.prototype,q=n&&p.prototype,r=n&&F(q),s=new b.Map()[c](),t=F(s),u=new b.Set()[c](),v=F(u),w=new b.String()[c](),x=F(w),y=b.eval('(function () { "use strict"; return Object.getOwnPropertyDescriptor(arguments, "callee").get; })()'),z=F(b.Int8Array),A=z.prototype,B={Array:b.Array,ArrayBuffer:b.ArrayBuffer,ArrayBufferPrototype:b.ArrayBuffer.prototype,ArrayIteratorPrototype:e,ArrayPrototype:b.Array.prototype,ArrayProto_entries:b.Array.prototype.entries,ArrayProto_foreach:b.Array.prototype.forEach,ArrayProto_keys:b.Array.prototype.forEach,ArrayProto_values:b.Array.prototype.values,AsyncFunction:h,AsyncFunctionPrototype:i,AsyncGenerator:p,AsyncGeneratorFunction:o,AsyncGeneratorPrototype:q,AsyncIteratorPrototype:r,Boolean:b.Boolean,BooleanPrototype:b.Boolean.prototype,DataView:b.DataView,DataViewPrototype:b.DataView.prototype,Date:b.Date,DatePrototype:b.Date.prototype,decodeURI:b.decodeURI,decodeURIComponent:b.decodeURIComponent,encodeURI:b.encodeURI,encodeURIComponent:b.encodeURIComponent,Error:b.Error,ErrorPrototype:b.Error.prototype,eval:b.eval,EvalError:b.EvalError,EvalErrorPrototype:b.EvalError.prototype,Float32Array:b.Float32Array,Float32ArrayPrototype:b.Float32Array.prototype,Float64Array:b.Float64Array,Float64ArrayPrototype:b.Float64Array.prototype,Function:b.Function,FunctionPrototype:b.Function.prototype,Generator:l,GeneratorFunction:k,GeneratorPrototype:m,Int8Array:b.Int8Array,Int8ArrayPrototype:b.Int8Array.prototype,Int16Array:b.Int16Array,Int16ArrayPrototype:b.Int16Array.prototype,Int32Array:b.Int32Array,Int32ArrayPrototype:b.Int32Array.prototype,isFinite:b.isFinite,isNaN:b.isNaN,IteratorPrototype:f,JSON:b.JSON,JSONParse:b.JSON.parse,Map:b.Map,MapIteratorPrototype:t,MapPrototype:b.Map.prototype,Math:b.Math,Number:b.Number,NumberPrototype:b.Number.prototype,Object:b.Object,ObjectPrototype:b.Object.prototype,ObjProto_toString:b.Object.prototype.toString,ObjProto_valueOf:b.Object.prototype.valueOf,parseFloat:b.parseFloat,parseInt:b.parseInt,Promise:b.Promise,Promise_all:b.Promise.all,Promise_reject:b.Promise.reject,Promise_resolve:b.Promise.resolve,PromiseProto_then:b.Promise.prototype.then,PromisePrototype:b.Promise.prototype,Proxy:b.Proxy,RangeError:b.RangeError,RangeErrorPrototype:b.RangeError.prototype,ReferenceError:b.ReferenceError,ReferenceErrorPrototype:b.ReferenceError.prototype,Reflect:b.Reflect,RegExp:b.RegExp,RegExpPrototype:b.RegExp.prototype,Set:b.Set,SetIteratorPrototype:v,SetPrototype:b.Set.prototype,String:b.String,StringIteratorPrototype:x,StringPrototype:b.String.prototype,Symbol:b.Symbol,SymbolPrototype:b.Symbol.prototype,SyntaxError:b.SyntaxError,SyntaxErrorPrototype:b.SyntaxError.prototype,ThrowTypeError:y,TypedArray:z,TypedArrayPrototype:A,TypeError:b.TypeError,TypeErrorPrototype:b.TypeError.prototype,Uint8Array:b.Uint8Array,Uint8ArrayPrototype:b.Uint8Array.prototype,Uint8ClampedArray:b.Uint8ClampedArray,Uint8ClampedArrayPrototype:b.Uint8ClampedArray.prototype,Uint16Array:b.Uint16Array,Uint16ArrayPrototype:b.Uint16Array.prototype,Uint32Array:b.Uint32Array,Uint32ArrayPrototype:b.Uint32Array.prototype,URIError:b.URIError,URIErrorPrototype:b.URIError.prototype,WeakMap:b.WeakMap,WeakMapPrototype:b.WeakMap.prototype,WeakSet:b.WeakSet,WeakSetPrototype:b.WeakSet.prototype,escape:b.escape,unescape:b.unescape,Intl:b.Intl,Realm:b.Realm};return B}function m(a){return'function'==typeof a}function n(a,b){const{contextEval:c,contextGlobal:d}=a,e=c(O)(b);d.Realm=e,P.set(e.prototype,a)}function o(a){return w(a.ObjectPrototype)}function p(a){const b=c(a),e=d(a),f=a[r];f.eval=b,f.Function=e,a[t]=b}function q(a){const b=a[r],c=k(b);x(a[s],c)}const r=Symbol('Intrinsics Slot'),s=Symbol('GlobalObject Slot'),t=Symbol('IsDirectEvalTrap Slot'),u=Symbol('Shim Context'),{assign:v,create:w,defineProperties:x,freeze:y,getOwnPropertyDescriptors:z,getOwnPropertyNames:A}=Object,{apply:B,defineProperty:C,deleteProperty:D,getOwnPropertyDescriptor:E,getPrototypeOf:F,ownKeys:G,setPrototypeOf:H}=Reflect;class I{constructor(a){const{contextGlobal:b}=a;this.contextGlobal=b,this.isInternalEvaluation=!1}get(a,b){return'eval'===b?this.isInternalEvaluation?(this.isInternalEvaluation=!1,this.contextGlobal.eval):a.eval:b in a?a[b]:void 0}has(a,b){return'eval'===b||'arguments'!==b&&(!!(b in a)||!!(b in this.contextGlobal))}}const J='object'==typeof exports&&'undefined'!=typeof module,K=J?require('vm'):void 0,L='({ global: this, eval, Function })',M=J?function(){const a=K.runInNewContext(L);return a}:function(){const a=document.createElement('iframe');a.style.display='none',document.body.appendChild(a);const b=a.contentWindow.eval(L);return b},N=new WeakMap,P=new WeakMap,O=`(${function(a){function b(a){try{return a()}catch(a){let b,d;try{b=`${a.name}`,d=`${a.message}`}catch(a){throw new Error('Something bad happened')}const e=c.get(b)||Error;throw new e(d)}}const c=new Map([['EvalError',EvalError],['RangeError',RangeError],['ReferenceError',ReferenceError],['SyntaxError',SyntaxError],['TypeError',TypeError],['URIError',URIError]]),d=Object.getOwnPropertyDescriptors(a.prototype);class e{constructor(...c){return b(()=>Reflect.construct(a,c,e))}init(){return b(()=>d.init.value.apply(this))}get intrinsics(){return b(()=>d.intrinsics.get.apply(this))}get global(){return b(()=>d.global.get.apply(this))}evaluate(...a){return b(()=>d.evaluate.value.apply(this,a))}}return Object.defineProperty(e.prototype,Symbol.toStringTag,{value:'function Realm() { [shim code] }',writable:!1,enumerable:!1,configurable:!0}),e}})`;class Q{constructor(a){const b=this;a=Object(a);let c;if('inherit'===a.intrinsics)c=P.get(F(this));else if(void 0===a.intrinsics)c=i(),n(c,Q);else throw new TypeError('Realm only supports undefined or "inherited" intrinsics.');const d=l(c),e=o(d),f={[u]:c,[r]:d,[s]:e,[t]:void 0};N.set(b,f);const g=b.init;if(!m(g))throw new TypeError;g.call(b)}init(){const a=this;if('object'!=typeof a)throw new TypeError;if(!N.has(a))throw new TypeError;const b=N.get(a);p(b),q(b)}get intrinsics(){const a=this;if('object'!=typeof a)throw new TypeError;if(!N.has(a))throw new TypeError;const b=N.get(a),c=b[r],d=w(c.ObjectPrototype);return v(d,c)}get global(){const a=this;if('object'!=typeof a)throw new TypeError;if(!N.has(a))throw new TypeError;const b=N.get(a);return b[s]}evaluate(a){const b=this;if('object'!=typeof b)throw new TypeError;if(!N.has(b))throw new TypeError;const c=N.get(b),d=c[t];return d(`${a}`)}}return P.set(Q.prototype,function(){const a=j();return i(a)}()),C(Q.prototype,Symbol.toStringTag,{value:'function Realm() { [shim code] }',writable:!1,enumerable:!1,configurable:!0}),Q});
//# sourceMappingURL=realm-shim.min.js.map
